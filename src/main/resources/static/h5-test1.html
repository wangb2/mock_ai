<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>RSMS æ™ºèƒ½Mockç³»ç»Ÿ</title>
    <style>
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: #0a0e27;
        color: #0f172a;
        position: relative;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(147, 51, 234, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 60%),
          linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1629 100%);
        z-index: -1;
      }
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          repeating-linear-gradient(0deg, rgba(99, 102, 241, 0.03) 0px, transparent 1px, transparent 2px, rgba(99, 102, 241, 0.03) 3px),
          repeating-linear-gradient(90deg, rgba(99, 102, 241, 0.03) 0px, transparent 1px, transparent 2px, rgba(99, 102, 241, 0.03) 3px);
        background-size: 60px 60px;
        z-index: -1;
        opacity: 0.4;
      }
      a { color: #dc2626; text-decoration: none; }
      .topbar {
        background: linear-gradient(135deg, rgba(10, 14, 39, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
        backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(99, 102, 241, 0.25);
        padding: 16px 32px;
        display: flex;
        align-items: center;
        gap: 24px;
        justify-content: space-between;
        box-shadow: 0 4px 32px rgba(0, 0, 0, 0.4), 0 0 1px rgba(99, 102, 241, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .brand-logo {
        height: 44px;
        width: auto;
        max-width: 200px;
        object-fit: contain;
        display: inline-block;
        filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.3));
      }
      .brand small {
        color: #a5b4fc;
        font-weight: 500;
      }
      .ui-build {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 999px;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.7) 0%, rgba(30, 41, 59, 0.6) 100%);
        border: 1px solid rgba(139, 151, 252, 0.25);
        color: rgba(226, 232, 240, 0.8);
        font-size: 11px;
        line-height: 1;
        user-select: text;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }
      .nav {
        display: flex;
        gap: 8px;
        font-size: 14px;
        color: #cbd5e1;
        background: rgba(15, 23, 42, 0.5);
        padding: 6px;
        border-radius: 999px;
        border: 1px solid rgba(99, 102, 241, 0.15);
      }
      .nav span {
        padding: 8px 18px;
        border-radius: 999px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        position: relative;
        white-space: nowrap;
      }
      .nav span::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 999px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .nav span:hover {
        color: #e2e8f0;
        transform: translateY(-1px);
      }
      .nav span:hover::before {
        opacity: 1;
      }
      .nav .active {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: #fff;
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        font-weight: 600;
      }
      .nav .active::before {
        opacity: 0;
      }
      .nav .active:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }
      .main {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px 28px 60px;
      }
      .hero {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 24px;
        padding: 60px 40px;
        margin-bottom: 32px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }
      .hero::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -10%;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 8s ease-in-out infinite;
      }
      .hero::after {
        content: "";
        position: absolute;
        bottom: -30%;
        left: -5%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(147, 51, 234, 0.12) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 10s ease-in-out infinite reverse;
      }
      @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); }
        50% { transform: translate(30px, 30px) scale(1.1); }
      }
      .hero-content {
        position: relative;
        z-index: 1;
        text-align: center;
      }
      .hero h1 {
        margin: 0 0 16px;
        font-size: 48px;
        font-weight: 700;
        background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
      }
      .hero .tagline {
        font-size: 20px;
        color: #cbd5e1;
        margin: 0 0 12px;
        font-weight: 500;
        line-height: 1.6;
      }
      .hero .subtitle {
        margin: 0;
        color: #94a3b8;
        font-size: 16px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.8;
      }
      .hero .ai-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid rgba(99, 102, 241, 0.3);
        padding: 6px 16px;
        border-radius: 999px;
        font-size: 13px;
        color: #a5b4fc;
        margin-bottom: 20px;
        backdrop-filter: blur(8px);
      }
      .hero .ai-badge::before {
        content: "âœ¨";
        font-size: 16px;
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.2); }
      }
      .section-title {
        margin: 24px 0 20px;
        font-weight: 600;
        color: #f1f5f9;
        font-size: 20px;
        text-align: center;
        position: relative;
        padding-bottom: 12px;
      }
      .section-title::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, transparent 0%, #6366f1 50%, transparent 100%);
        border-radius: 2px;
      }
      #doc .section-title,
      #api .section-title,
      #scene .section-title,
      #debug .section-title,
      #logs .section-title {
        text-align: left;
        padding-left: 16px;
        border-left: 4px solid;
        border-image: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) 1;
        margin-bottom: 24px;
      }
      #doc .section-title::after,
      #api .section-title::after,
      #scene .section-title::after,
      #debug .section-title::after,
      #logs .section-title::after {
        display: none;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      .quick-grid {
        display: grid;
        grid-template-columns: repeat(5, minmax(0, 1fr));
        gap: 16px;
      }
      .quick {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 20px;
        padding: 28px 20px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
        backdrop-filter: blur(8px);
        position: relative;
        overflow: hidden;
      }
      .quick::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .quick:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 48px rgba(99, 102, 241, 0.3);
        border-color: rgba(99, 102, 241, 0.5);
      }
      .quick:hover::before {
        opacity: 1;
      }
      .quick.active {
        transform: translateY(-6px);
        box-shadow: 0 16px 48px rgba(99, 102, 241, 0.4);
        border-color: rgba(99, 102, 241, 0.6);
        background: rgba(30, 41, 59, 0.7);
      }
      .quick.active::before {
        opacity: 1;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);
      }
      .quick .icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: #fff;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      }
      .quick .title {
        font-weight: 600;
        margin-bottom: 8px;
        color: #e2e8f0;
        font-size: 15px;
        position: relative;
        z-index: 1;
      }
      .quick .desc {
        font-size: 13px;
        color: #94a3b8;
        position: relative;
        z-index: 1;
        line-height: 1.5;
      }
      .card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(100, 116, 139, 0.3);
        transition: all 0.3s ease;
        backdrop-filter: blur(16px);
        position: relative;
      }
      .card:hover {
        box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
        border-color: rgba(139, 151, 252, 0.4);
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 4px;
      }
      .row strong {
        color: #f1f5f9;
        font-size: 16px;
        font-weight: 600;
      }
      .api-card .row {
        /* Keep method pill + title on one line and vertically aligned */
        flex-wrap: nowrap;
        align-items: center;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        margin-bottom: 12px;
      }
      .api-card .row h3 {
        margin: 0;
        flex: 1 1 auto;
        min-width: 0;
      }
      .grow { flex: 1 1 auto; }
      label { 
        font-size: 13px; 
        color: #cbd5e1; 
        font-weight: 500;
        display: block;
        margin-bottom: 8px;
      }
      input[type="text"], input[type="file"], textarea, select {
        padding: 11px 14px;
        border: 1px solid rgba(100, 116, 139, 0.4);
        border-radius: 10px;
        background: rgba(15, 23, 42, 0.6);
        width: 100%;
        color: #e2e8f0;
        backdrop-filter: blur(12px);
        transition: all 0.3s ease;
        font-size: 13px;
      }
      input[type="text"]:hover, textarea:hover {
        border-color: rgba(139, 151, 252, 0.4);
        background: rgba(15, 23, 42, 0.7);
      }
      input[type="text"]:focus, textarea:focus {
        outline: none;
        border-color: rgba(139, 151, 252, 0.6);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.15);
        background: rgba(15, 23, 42, 0.8);
      }
      input[type="file"] {
        display: none;
      }
      .custom-file-upload {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 9px 18px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.8) 0%, rgba(139, 92, 246, 0.8) 100%);
        border: 1px solid rgba(139, 151, 252, 0.4);
        border-radius: 8px;
        color: #fff;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
        box-shadow: 0 2px 12px rgba(99, 102, 241, 0.3);
        margin-top: 12px;
        position: relative;
        overflow: hidden;
      }
      .custom-file-upload::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.5s, height 0.5s;
      }
      .custom-file-upload:hover::after {
        width: 300px;
        height: 300px;
      }
      .custom-file-upload:hover {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.9) 0%, rgba(168, 85, 247, 0.9) 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        border-color: rgba(139, 151, 252, 0.6);
      }
      .custom-file-upload:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
      }
      .custom-file-upload span {
        position: relative;
        z-index: 1;
      }
      .custom-file-upload::before {
        content: "ðŸ“Ž";
        font-size: 14px;
        position: relative;
        z-index: 1;
      }

      /* Doc page: file select (green) + generate mock (blue) */
      #doc .custom-file-upload.doc-btn-green {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.22) 0%,
          rgba(34, 197, 94, 0.18) 100%
        );
        border: 1px solid rgba(74, 222, 128, 0.36);
        color: rgba(226, 232, 240, 0.98);
        box-shadow: 0 10px 28px rgba(34, 197, 94, 0.16);
      }
      #doc .custom-file-upload.doc-btn-green:hover {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.3) 0%,
          rgba(34, 197, 94, 0.26) 100%
        );
        border-color: rgba(74, 222, 128, 0.52);
        box-shadow: 0 12px 34px rgba(34, 197, 94, 0.22);
      }
      #doc .custom-file-upload.doc-btn-green:active {
        box-shadow: 0 8px 22px rgba(34, 197, 94, 0.16);
      }

      #doc #sendBtn.doc-btn-blue {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.26) 0%,
          rgba(34, 211, 238, 0.18) 100%
        );
        border: 1px solid rgba(34, 211, 238, 0.38);
        color: rgba(226, 232, 240, 0.98);
        box-shadow: 0 8px 26px rgba(59, 130, 246, 0.16);
      }
      #doc #sendBtn.doc-btn-blue:hover {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.34) 0%,
          rgba(34, 211, 238, 0.24) 100%
        );
        border-color: rgba(34, 211, 238, 0.55);
        box-shadow: 0 10px 30px rgba(34, 211, 238, 0.22);
      }
      #doc #sendBtn.doc-btn-blue:active {
        transform: translateY(0);
        box-shadow: 0 6px 18px rgba(59, 130, 246, 0.14);
      }
      .file-name-display {
        margin-top: 10px;
        padding: 8px 14px;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.08) 100%);
        border: 1px solid rgba(74, 222, 128, 0.25);
        border-radius: 8px;
        color: #86efac;
        font-size: 12px;
        text-align: center;
        display: none;
        backdrop-filter: blur(12px);
        animation: slideIn 0.3s ease;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(34, 197, 94, 0.1);
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .file-name-display.show {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .file-name-display::before {
        content: "âœ“";
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: rgba(34, 197, 94, 0.2);
        border-radius: 50%;
        font-size: 11px;
        font-weight: 700;
      }
      /* AI Loading Progress Bar with Running Horse */
      .ai-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(8px);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10;
        border-radius: 12px;
      }
      .ai-loading-overlay.show {
        display: flex;
      }
      .ai-loading-title {
        color: #a5b4fc;
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 24px;
        text-align: center;
      }
      .ai-progress-track {
        width: 80%;
        max-width: 500px;
        height: 8px;
        background: rgba(30, 41, 59, 0.8);
        border-radius: 999px;
        position: relative;
        overflow: visible;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      .ai-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
        background-size: 200% 100%;
        border-radius: 999px;
        width: 0%;
        animation: progressShine 2s ease-in-out infinite;
        box-shadow: 0 0 12px rgba(99, 102, 241, 0.6);
      }
      @keyframes progressShine {
        0%, 100% { background-position: 0% 0%; }
        50% { background-position: 100% 0%; }
      }
      .ai-horse {
        position: absolute;
        top: 50%;
        left: 0%;
        transform: translate(-50%, -50%) scaleX(-1);
        font-size: 32px;
        animation: horseRun 2.5s linear infinite, horseJump 0.25s ease-in-out infinite;
        filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.8));
      }
      @keyframes horseRun {
        0% { left: 0%; }
        100% { left: 100%; }
      }
      @keyframes horseJump {
        0%, 100% { 
          transform: translate(-50%, -50%) scaleX(-1) translateY(0px); 
        }
        50% { 
          transform: translate(-50%, -50%) scaleX(-1) translateY(-6px); 
        }
      }
      .ai-loading-hint {
        margin-top: 20px;
        color: #94a3b8;
        font-size: 13px;
        text-align: center;
      }
      button {
        padding: 12px 20px;
        border: 1px solid rgba(139, 151, 252, 0.3);
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.08) 100%);
        color: #e2e8f0;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
        font-weight: 500;
        font-size: 14px;
      }
      button:hover {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);
        border-color: rgba(139, 151, 252, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.25);
      }
      .btn-primary {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.9) 0%, rgba(139, 92, 246, 0.9) 100%);
        color: #fff;
        border: 1px solid rgba(139, 151, 252, 0.5);
        box-shadow: 0 2px 16px rgba(99, 102, 241, 0.3);
        font-weight: 600;
      }
      .btn-primary:hover {
        box-shadow: 0 4px 24px rgba(99, 102, 241, 0.4);
        transform: translateY(-1px);
        border-color: rgba(139, 151, 252, 0.7);
      }
      /* Debug send button: green semi-transparent, compact */
      #sendMockBtn {
        min-width: auto;
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 700;
        justify-content: flex-start;
        gap: 8px;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.18) 0%, rgba(22, 163, 74, 0.14) 100%);
        border: 1px solid rgba(34, 197, 94, 0.45);
        color: #4ade80;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.18);
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease, background 0.18s ease;
      }
      #sendMockBtn:hover:not(:disabled) {
        transform: translateY(-1px);
        filter: brightness(1.06);
        border-color: rgba(34, 197, 94, 0.7);
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.26);
      }
      #sendMockBtn:active {
        transform: translateY(0);
        filter: brightness(0.98);
      }
      #sendMockBtn.is-success {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.95) 0%, rgba(22, 163, 74, 0.95) 100%) !important;
        border-color: rgba(34, 197, 94, 0.7) !important;
        box-shadow: 0 6px 22px rgba(34, 197, 94, 0.35) !important;
      }
      #sendMockBtn.is-error {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.95) 0%, rgba(220, 38, 38, 0.95) 100%) !important;
        border-color: rgba(239, 68, 68, 0.7) !important;
        box-shadow: 0 6px 22px rgba(239, 68, 68, 0.35) !important;
      }
      button.secondary {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
        color: #cbd5e1;
        border-color: rgba(139, 151, 252, 0.3);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      button.secondary:hover {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 1) 100%);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
      }
      button:disabled {
        background: rgba(71, 85, 105, 0.3);
        cursor: not-allowed;
        box-shadow: none;
        opacity: 0.5;
        border-color: rgba(71, 85, 105, 0.3);
        color: #64748b;
      }
      button:disabled:hover {
        transform: none;
        box-shadow: none;
      }
      .btn-outline {
        background: rgba(30, 41, 59, 0.6);
        color: #cbd5e1;
        border: 1px solid rgba(100, 116, 139, 0.4);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      .btn-outline:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
      }
      /* Compact "å¤åˆ¶å‘½ä»¤" button in debug section */
      #copyCurlBtn {
        padding: 6px 12px;
        font-size: 12px;
        min-width: auto;
      }
      /* Compact "åˆ·æ–°æ—¥å¿—" button */
      #refreshLogsBtn {
        padding: 6px 12px;
        font-size: 12px;
        min-width: auto;
      }
      /* Make "ç¼–è¾‘é…ç½®" and "ä¿å­˜ä¿®æ”¹" buttons match "å…³é—­" secondary style */
      .api-actions .action-btn[data-edit] {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
        color: #cbd5e1;
        border-color: rgba(139, 151, 252, 0.3);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      .api-actions .action-btn[data-edit]:hover {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 1) 100%);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
      }
      #saveEditBtn {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%) !important;
        color: #cbd5e1 !important;
        border-color: rgba(139, 151, 252, 0.3) !important;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        cursor: pointer;
      }
      #saveEditBtn:hover:not(:disabled) {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 1) 100%) !important;
        border-color: rgba(139, 151, 252, 0.5) !important;
        color: #e2e8f0 !important;
      }
      /* Copy cURL button: compact size */
      #copyCurlBtn {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 8px;
        min-width: auto;
      }
      .progress-wrap {
        margin-top: 12px;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 999px;
        height: 4px;
        overflow: hidden;
        display: none;
        border: 1px solid rgba(100, 116, 139, 0.3);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
      }
      .progress-bar {
        width: 40%;
        height: 100%;
        background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
        box-shadow: 0 0 6px rgba(99, 102, 241, 0.5);
      }
      .doc-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 24px;
        align-items: stretch;
        margin-top: 24px;
      }
      @media (max-width: 1024px) {
        .doc-grid {
          grid-template-columns: 1fr;
        }
      }
      .doc-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 16px;
        padding: 24px;
        height: 100%;
        backdrop-filter: blur(16px);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        position: relative;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      .doc-card:hover {
        border-color: rgba(139, 151, 252, 0.4);
        box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
      }
      .doc-title {
        font-weight: 600;
        color: #f1f5f9;
        margin-bottom: 20px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(100, 116, 139, 0.2);
      }
      .doc-title .icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }
      .upload-area {
        border: 2px dashed rgba(100, 116, 139, 0.4);
        border-radius: 12px;
        padding: 32px 24px;
        text-align: center;
        color: #cbd5e1;
        background: rgba(15, 23, 42, 0.4);
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
        cursor: pointer;
        position: relative;
      }
      .upload-area:hover {
        border-color: rgba(139, 151, 252, 0.5);
        background: rgba(15, 23, 42, 0.5);
      }
      .upload-area.dragover {
        border-color: #6366f1;
        border-style: solid;
        background: rgba(99, 102, 241, 0.1);
        color: #c7d2fe;
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.25), inset 0 0 20px rgba(99, 102, 241, 0.1);
      }
      .upload-area .icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
        color: #818cf8;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 14px;
        font-size: 22px;
        border: 1px solid rgba(99, 102, 241, 0.2);
      }
      .upload-area .upload-text {
        font-size: 14px;
        font-weight: 500;
        color: #e2e8f0;
        margin-bottom: 6px;
      }
      .upload-area .upload-hint {
        font-size: 12px;
        color: #94a3b8;
      }
      .doc-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 16px;
        flex-wrap: wrap;
      }
      .doc-actions .hint {
        margin-top: 0;
      }
      /* Doc actions: make copy/refresh/status look consistent */
      .doc-actions .doc-action-btn,
      .doc-actions #status.doc-action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        font-size: 13px;
        font-weight: 500;
        padding: 8px 14px;
        min-height: 34px;
        min-width: 112px;
        border-radius: 12px;
        background: rgba(30, 41, 59, 0.6);
        color: #e2e8f0;
        border: 1px solid rgba(100, 116, 139, 0.4);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(12px);
        white-space: nowrap;
        box-sizing: border-box;
      }
      .doc-actions button.doc-action-btn:hover:not(:disabled) {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(139, 151, 252, 0.5);
        transform: translateY(-1px);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.22);
      }
      .doc-actions button.doc-action-btn:active:not(:disabled) {
        transform: translateY(0);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.18);
      }
      .doc-actions button.doc-action-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
      }
      .doc-actions #status.doc-action-btn {
        cursor: default;
        user-select: none;
      }
      .doc-actions button {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        padding: 8px 14px;
      }
      .btn-outline-gray {
        background: rgba(30, 41, 59, 0.6);
        color: #cbd5e1;
        border: 1px solid rgba(100, 116, 139, 0.4);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      .btn-outline-gray:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
      }
      .doc-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 16px;
      }
      .scene-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 12px;
      }
      .scene-item {
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 12px;
        padding: 16px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(15, 23, 42, 0.5);
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        gap: 12px;
      }
      .scene-item:hover {
        border-color: rgba(139, 151, 252, 0.5);
        background: rgba(15, 23, 42, 0.7);
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.15);
        transform: translateX(3px);
      }
      .scene-item .name {
        font-weight: 600;
        color: #f1f5f9;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .scene-item .name::before {
        content: "ðŸŽ¬";
        font-size: 16px;
        opacity: 0.85;
      }
      .scene-item .meta {
        font-size: 11px;
        color: #94a3b8;
        margin-top: 5px;
        font-family: 'Courier New', monospace;
      }
      .scene-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .doc-item {
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 12px;
        padding: 16px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(15, 23, 42, 0.5);
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      .doc-item:hover {
        border-color: rgba(139, 151, 252, 0.5);
        background: rgba(15, 23, 42, 0.7);
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.15);
        transform: translateX(3px);
      }
      .doc-item .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: #60a5fa;
        border-color: rgba(59, 130, 246, 0.3);
      }
      .doc-item .action-btn:hover {
        color: #93c5fd;
        border-color: rgba(59, 130, 246, 0.5);
      }
      .action-btn.danger {
        color: #fca5a5;
        border-color: rgba(239, 68, 68, 0.5);
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.15) 100%);
      }
      .action-btn.danger:hover {
        color: #fecaca;
        border-color: rgba(239, 68, 68, 0.7);
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.25) 100%);
        box-shadow: 0 4px 16px rgba(239, 68, 68, 0.25);
      }
      .action-btn.danger:active {
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
      }
      .doc-item .name {
        font-weight: 600;
        color: #f1f5f9;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .doc-item .name::before {
        content: "ðŸ“„";
        font-size: 16px;
        opacity: 0.8;
      }
      .doc-item .meta {
        font-size: 11px;
        color: #94a3b8;
        margin-top: 5px;
        font-family: 'Courier New', monospace;
      }
      .doc-file {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 14px;
        border: 1px solid rgba(139, 151, 252, 0.25);
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.06) 0%, rgba(139, 92, 246, 0.04) 100%);
        backdrop-filter: blur(12px);
      }
      .doc-file .badge {
        background: rgba(239, 68, 68, 0.15);
        color: #fca5a5;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .api-toolbar {
        display: grid;
        grid-template-columns: 1fr 1fr auto auto;
        gap: 12px;
        align-items: center;
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        padding: 14px 18px;
        backdrop-filter: blur(8px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      }
      .api-toolbar .search {
        display: flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 10px;
        padding: 8px 12px;
        background: rgba(15, 23, 42, 0.45);
        transition: all 0.3s ease;
      }
      .api-toolbar .search:focus-within {
        box-shadow: none;
        background: rgba(15, 23, 42, 0.55);
      }
      .api-toolbar .search input {
        border: none;
        outline: none;
        background: transparent;
        padding: 0;
        color: #e2e8f0;
      }
      .api-toolbar .search input:-webkit-autofill,
      .api-toolbar .search input:-webkit-autofill:hover,
      .api-toolbar .search input:-webkit-autofill:focus,
      .api-toolbar .search input:-webkit-autofill:active {
        -webkit-box-shadow: 0 0 0 1000px rgba(15, 23, 42, 0.55) inset !important;
        -webkit-text-fill-color: #e2e8f0 !important;
        transition: background-color 5000s ease-in-out 0s;
      }
      .api-toolbar .search input::placeholder {
        color: #64748b;
      }
      .api-toolbar .summary {
        color: #94a3b8;
        font-size: 13px;
      }
      .api-toolbar .scene-filter {
        display: flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 10px;
        padding: 8px 12px;
        background: rgba(15, 23, 42, 0.45);
        transition: all 0.3s ease;
      }
      .api-toolbar .scene-filter select {
        border: none;
        outline: none;
        background: transparent;
        color: #e2e8f0;
        width: 100%;
      }
      .api-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 16px;
        padding: 20px 24px;
        margin-top: 16px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 20px;
        backdrop-filter: blur(16px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        overflow: hidden;
      }
      .api-card:hover {
        border-color: rgba(139, 151, 252, 0.4);
        box-shadow: 0 6px 28px rgba(99, 102, 241, 0.15);
        transform: translateY(-1px);
      }
      @media (max-width: 768px) {
        .api-card {
          grid-template-columns: 1fr;
        }
      }
      .api-card h3 {
        margin: 0;
        font-size: 17px;
        color: #f1f5f9;
        font-weight: 600;
        word-break: break-word;
        overflow-wrap: break-word;
        line-height: 1.4;
      }
      .api-card > div:first-child {
        min-width: 0;
        overflow: hidden;
      }
      .method {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 5px 12px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.5px;
        line-height: 1;
        background: rgba(15, 23, 42, 0.35);
        color: #cbd5e1;
        border: 1px solid rgba(100, 116, 139, 0.35);
        min-width: 60px;
      }
      /* API method colors (semi-transparent) */
      .method.get {
        background: rgba(59, 130, 246, 0.18);
        border-color: rgba(59, 130, 246, 0.45);
        color: #93c5fd;
      }
      .method.post {
        background: rgba(34, 197, 94, 0.18);
        border-color: rgba(34, 197, 94, 0.45);
        color: #86efac;
      }
      .method.put {
        background: rgba(245, 158, 11, 0.18);
        border-color: rgba(245, 158, 11, 0.5);
        color: #fcd34d;
      }
      .method.delete {
        background: rgba(239, 68, 68, 0.18);
        border-color: rgba(239, 68, 68, 0.5);
        color: #fca5a5;
      }
      .method.patch {
        background: rgba(139, 92, 246, 0.16);
        border-color: rgba(139, 92, 246, 0.45);
        color: #c4b5fd;
      }
      .api-meta {
        font-size: 12px;
        color: #94a3b8;
        margin: 8px 0;
        line-height: 1.5;
      }
      .api-meta-title {
        color: #e2e8f0;
        font-weight: 500;
        letter-spacing: 0.2px;
        margin-top: 10px;
      }
      .api-meta-source {
        color: #cbd5e1;
      }
      .api-meta-strong {
        color: #e2e8f0;
        font-weight: 500;
      }
      .api-meta a {
        color: #60a5fa;
        text-decoration: none;
        margin-left: 8px;
        transition: color 0.3s ease;
      }
      .api-meta a:hover {
        color: #93c5fd;
        text-decoration: underline;
      }
      .api-url {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 10px;
        padding: 12px 14px;
        font-size: 13px;
        color: #cbd5e1;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        line-height: 1.6;
        margin: 10px 0;
      }
      .api-url > span {
        flex: 1;
        min-width: 0;
        display: flex;
        align-items: center;
        word-break: break-all;
        overflow-wrap: anywhere;
        white-space: pre-wrap;
        user-select: all;
      }
      .api-url > span::selection {
        background: rgba(99, 102, 241, 0.35);
        color: #fff;
      }
      .api-url button {
        flex-shrink: 0;
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid rgba(139, 151, 252, 0.4);
        color: #a5b4fc;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .api-url button:hover {
        background: rgba(99, 102, 241, 0.3);
        border-color: rgba(139, 151, 252, 0.6);
        color: #c7d2fe;
      }
      .api-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        justify-content: flex-start;
        /* keep previous look, only make the column a bit narrower */
        min-width: 146px;
      }
      /* Make the 5 action buttons consistent: compact + filled (like â€œè°ƒè¯•æˆåŠŸå“åº”â€), no flashy shimmer. */
      .api-actions button {
        width: 100%;
        white-space: nowrap;
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
        font-weight: 700;
        font-size: 11px;
        padding: 8px 12px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 8px;
        border: 1px solid rgba(100, 116, 139, 0.35);
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.18);
        background: rgba(15, 23, 42, 0.45);
      }
      .api-actions button > span {
        width: 16px;
        display: inline-flex;
        justify-content: center;
        opacity: 0.95;
      }
      .api-actions button:hover {
        transform: translateY(-1px);
        filter: brightness(1.06);
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.26);
      }
      .api-actions .play:hover { border-color: rgba(34, 197, 94, 0.7); }
      .api-actions .json:hover { border-color: rgba(139, 151, 252, 0.7); }
      .api-actions .action-btn.warn:hover { border-color: rgba(245, 158, 11, 0.75); }
      .api-actions .action-btn.danger:hover { border-color: rgba(239, 68, 68, 0.75); }
      .api-actions button:active {
        transform: translateY(0);
        filter: brightness(1.02);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
      }
      .api-actions .play {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.18) 0%, rgba(22, 163, 74, 0.14) 100%);
        border-color: rgba(34, 197, 94, 0.45);
        color: #4ade80;
      }
      .api-actions .json {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.18) 0%, rgba(139, 92, 246, 0.14) 100%);
        border-color: rgba(139, 151, 252, 0.45);
        color: #a5b4fc;
      }
      .api-actions .action-btn:not(.danger) {
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.12) 0%, rgba(100, 116, 139, 0.10) 100%);
        border-color: rgba(148, 163, 184, 0.35);
        color: #cbd5e1;
      }
      .api-actions .action-btn.danger {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.18) 0%, rgba(220, 38, 38, 0.14) 100%);
        border-color: rgba(239, 68, 68, 0.45);
        color: #fca5a5;
      }
      .api-actions .action-btn.warn {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.18) 0%, rgba(217, 119, 6, 0.14) 100%);
        border-color: rgba(245, 158, 11, 0.5);
        color: #fbbf24;
      }
      .debug-topbar {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.55) 0%, rgba(30, 41, 59, 0.45) 100%);
        border: 1px solid rgba(139, 151, 252, 0.18);
        border-radius: 18px;
        backdrop-filter: blur(16px);
        box-shadow: 0 10px 34px rgba(0, 0, 0, 0.28);
        position: relative;
      }
      .debug-topbar::before {
        content: "";
        position: absolute;
        inset: -1px;
        border-radius: 18px;
        background:
          radial-gradient(circle at 18% 30%, rgba(99, 102, 241, 0.22) 0%, transparent 55%),
          radial-gradient(circle at 85% 55%, rgba(34, 197, 94, 0.16) 0%, transparent 55%);
        pointer-events: none;
        opacity: 0.35;
        z-index: 0;
      }
      .debug-topbar > * { position: relative; z-index: 1; }
      .debug-url-wrap {
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 1px solid rgba(100, 116, 139, 0.35);
        border-radius: 14px;
        background: rgba(15, 23, 42, 0.62);
        padding: 10px 12px;
        backdrop-filter: blur(14px);
        transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04), inset 0 -8px 30px rgba(0, 0, 0, 0.35);
        position: relative;
        /* Allow dropdown to pop outside */
        overflow: visible;
        min-height: 44px;
      }
      .debug-url-wrap:focus-within {
        border-color: rgba(139, 151, 252, 0.55);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.05), inset 0 -8px 30px rgba(0, 0, 0, 0.35);
        background: rgba(15, 23, 42, 0.72);
      }
      .debug-url-wrap:hover {
        border-color: rgba(139, 151, 252, 0.32);
      }
      /* debug-url-icon removed */
      .debug-url-icon-placeholder {
        display: none;
        border-radius: 10px;
        background: rgba(99, 102, 241, 0.12);
        border: 1px solid rgba(139, 151, 252, 0.22);
        color: #a5b4fc;
        font-size: 14px;
        flex: 0 0 auto;
      }
      .debug-divider {
        width: 1px;
        height: 26px;
        background: rgba(100, 116, 139, 0.35);
        flex: 0 0 auto;
      }
      .debug-method {
        padding: 10px 20px;
        border-radius: 10px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: #fff;
        font-weight: 700;
        font-size: 13px;
        border: 1px solid rgba(139, 151, 252, 0.6);
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 90px;
        text-align: center;
        box-shadow: 0 3px 12px rgba(99, 102, 241, 0.4);
        letter-spacing: 0.8px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
      }
      .debug-method:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
        border-color: rgba(139, 151, 252, 0.8);
        box-shadow: 0 5px 20px rgba(99, 102, 241, 0.5);
        transform: translateY(-1px);
      }
      .debug-method:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
      }
      .debug-method:focus {
        outline: none;
        border-color: rgba(139, 151, 252, 0.8);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 3px 12px rgba(99, 102, 241, 0.4);
      }
      .debug-method option {
        background: #1e293b;
        color: #e2e8f0;
        padding: 12px 16px;
        font-weight: 600;
        font-size: 13px;
      }
      /* Method segmented toggle (replaces dropdown to avoid overlay/z-index issues) */
      .method-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.22);
        border: 1px solid rgba(100, 116, 139, 0.26);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
      }
      .method-pill {
        border: 1px solid transparent;
        background: transparent;
        color: #cbd5e1;
        font-weight: 800;
        font-size: 12px;
        letter-spacing: 0.6px;
        padding: 8px 14px;
        border-radius: 999px;
        cursor: pointer;
        transition: all 0.18s ease;
        min-width: 72px;
        text-align: center;
      }
      .method-pill:hover {
        color: #e2e8f0;
        border-color: rgba(100, 116, 139, 0.3);
      }
      /* Debug method colors (match API management: GET=blue, POST=green) */
      .method-pill[data-method="GET"] {
        color: #93c5fd;
      }
      .method-pill[data-method="GET"]:hover {
        border-color: rgba(59, 130, 246, 0.5);
      }
      .method-pill[data-method="GET"].active {
        background: rgba(59, 130, 246, 0.22);
        border-color: rgba(59, 130, 246, 0.62);
        color: #dbeafe;
        box-shadow: 0 6px 18px rgba(59, 130, 246, 0.28);
      }

      .method-pill[data-method="POST"] {
        color: #86efac;
      }
      .method-pill[data-method="POST"]:hover {
        border-color: rgba(34, 197, 94, 0.5);
      }
      .method-pill[data-method="POST"].active {
        background: rgba(34, 197, 94, 0.22);
        border-color: rgba(34, 197, 94, 0.62);
        color: #dcfce7;
        box-shadow: 0 6px 18px rgba(34, 197, 94, 0.24);
      }
      .method-pill:active {
        transform: translateY(0);
        filter: brightness(0.98);
      }
      .debug-url {
        flex: 1 1 auto;
        border: none;
        outline: none;
        background: transparent;
        color: #e2e8f0;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 14px;
        font-weight: 500;
        /* Visually center placeholder/value within the input area */
        line-height: 1.2;
        padding: 6px 0;
      }
      /* debug-url-icon focus state removed */
      .debug-url::placeholder {
        color: #64748b;
        font-style: italic;
      }
      .debug-url::selection {
        background: rgba(99, 102, 241, 0.3);
        color: #fff;
      }
      .debug-url:-webkit-autofill,
      .debug-url:-webkit-autofill:hover,
      .debug-url:-webkit-autofill:focus,
      .debug-url:-webkit-autofill:active {
        -webkit-box-shadow: 0 0 0 1000px transparent inset !important;
        -webkit-text-fill-color: #e2e8f0 !important;
        caret-color: #e2e8f0 !important;
        transition: background-color 5000s ease-in-out 0s;
      }
      .debug-tabs {
        display: flex;
        gap: 8px;
        font-size: 13px;
        color: #94a3b8;
        background: rgba(15, 23, 42, 0.4);
        padding: 8px 12px;
      }
      .debug-tabs span {
        padding: 8px 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        border-radius: 8px;
        font-weight: 500;
      }
      .debug-tabs span:hover {
        color: #cbd5e1;
        background: rgba(30, 41, 59, 0.6);
      }
      .debug-tabs .active {
        color: #e2e8f0;
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid rgba(139, 151, 252, 0.3);
      }
      .debug-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 16px;
      }
      @media (max-width: 1200px) {
        .debug-layout {
          grid-template-columns: 1fr;
        }
      }
      .debug-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(16px);
      }
      .debug-card-header {
        padding: 16px 18px;
        border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(15, 23, 42, 0.5);
      }
      .debug-card-title {
        font-weight: 700;
        color: #e2e8f0;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 15px;
      }
      .debug-card-title .badge {
        width: 32px;
        height: 32px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
        border: 1px solid rgba(139, 151, 252, 0.3);
        color: #a5b4fc;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
      }
      .debug-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
        color: #94a3b8;
        align-items: center;
        font-weight: 500;
      }
      .debug-meta > span {
        padding: 5px 12px;
        border-radius: 6px;
        background: rgba(15, 23, 42, 0.75);
        border: 1px solid rgba(139, 151, 252, 0.25);
        color: #e2e8f0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.16);
      }
      /* Prevent nested spans (like the colored time value) from getting pill styles */
      .debug-meta > span span {
        padding: 0 !important;
        border: 0 !important;
        background: transparent !important;
        box-shadow: none !important;
      }
      .debug-meta .ok {
        padding: 5px 12px;
        border-radius: 6px;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 163, 74, 0.15) 100%);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #4ade80;
        font-weight: 600;
      }
      /* Remove inner shadow feel for debug time pill */
      #debugTime {
        box-shadow: none !important;
      }
      .required-list {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        padding: 12px;
        background: rgba(15, 23, 42, 0.4);
        min-height: 20px;
      }
      .required-list:empty {
        display: none;
      }
      .required-list .chip {
        padding: 5px 12px;
        border-radius: 6px;
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid rgba(139, 151, 252, 0.3);
        font-size: 12px;
        color: #a5b4fc;
        font-weight: 500;
      }
      .debug-curl {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
        color: #e5e7eb;
        border-radius: 12px;
        border: 1px solid rgba(100, 116, 139, 0.3);
        padding: 16px;
        margin-top: 16px;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .debug-curl .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #94a3b8;
        font-size: 12px;
        font-weight: 600;
      }
      .debug-curl pre {
        background: transparent;
        color: #86efac;
        max-height: 240px;
        border: none;
        box-shadow: none;
        padding: 0;
        min-height: auto;
      }
      .btn-loading {
        opacity: 0.8;
        pointer-events: none;
        position: relative;
      }
      .btn-loading::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
        animation: shimmer-btn 1.5s infinite;
      }
      @keyframes shimmer-btn {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      .loading-dot {
        display: inline-block;
        position: relative;
        margin-left: 8px;
        width: 26px; /* reserve space for 3 dots so they won't overlap text */
        height: 6px;
        vertical-align: middle;
      }
      .loading-dot .dot,
      .loading-dot::before,
      .loading-dot::after {
        content: "";
        position: absolute;
        top: 0;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #fff;
        animation: loading-dots 1.4s infinite ease-in-out;
      }
      .loading-dot::before,
      .loading-dot::after {
        content: "";
      }
      .loading-dot {
        /* middle dot */
        background: transparent;
      }
      .loading-dot::marker { display: none; }
      .loading-dot::before { left: 0; animation-delay: -0.32s; }
      .loading-dot::after { left: 20px; animation-delay: 0.16s; }
      .loading-dot::before,
      .loading-dot::after {
        /* keep */
      }
      .loading-dot::marker { display: none; }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before { }
      .loading-dot::after { }
      .loading-dot::before {
        left: 0px;
        animation-delay: -0.32s;
      }
      .loading-dot::after {
        left: 20px;
        animation-delay: 0.16s;
      }
      /* Fix overlap/wrapping: render 3 dots via box-shadow, disable pseudo-element dots */
      .loading-dot {
        position: relative;
        margin-left: 8px;
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: -10px 0 0 rgba(255, 255, 255, 0.65), 10px 0 0 rgba(255, 255, 255, 0.65);
        vertical-align: middle;
      }
      .loading-dot::before,
      .loading-dot::after {
        content: none !important;
        display: none !important;
      }
      @keyframes loading-dots {
        0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
        40% { opacity: 1; transform: scale(1); }
      }
      @keyframes pulse {
        0% { transform: scale(1); opacity: 0.6; }
        50% { transform: scale(1.4); opacity: 1; }
        100% { transform: scale(1); opacity: 0.6; }
      }
      .kv-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        background: rgba(15, 23, 42, 0.3);
      }
      .kv-table th, .kv-table td {
        border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        padding: 10px 12px;
        text-align: left;
        color: #e2e8f0;
      }
      .kv-table th {
        color: #94a3b8;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.08em;
        font-weight: 600;
        background: rgba(15, 23, 42, 0.6);
      }
      .kv-table tbody tr {
        background: rgba(15, 23, 42, 0.2);
      }
      .kv-table tbody tr:hover {
        background: rgba(30, 41, 59, 0.5);
      }
      .kv-table td button {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #fca5a5;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .kv-table td button:hover {
        background: rgba(239, 68, 68, 0.3);
        border-color: rgba(239, 68, 68, 0.6);
      }
      .kv-input {
        width: 100%;
        border: 1px solid rgba(100, 116, 139, 0.4);
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 12px;
        background: rgba(15, 23, 42, 0.6);
        color: #e2e8f0;
        transition: all 0.3s ease;
      }
      .kv-input:hover {
        border-color: rgba(139, 151, 252, 0.4);
        background: rgba(15, 23, 42, 0.7);
      }
      .kv-input:focus {
        outline: none;
        border-color: rgba(139, 151, 252, 0.6);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.15);
        background: rgba(15, 23, 42, 0.8);
      }
      .kv-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 12px;
        border-top: 1px solid rgba(100, 116, 139, 0.2);
        background: rgba(15, 23, 42, 0.4);
      }
      .manual-table {
        margin-top: 8px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        overflow: hidden;
        background: rgba(15, 23, 42, 0.4);
      }
      .manual-toggle {
        display: inline-flex;
        gap: 8px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.35);
        border: 1px solid rgba(100, 116, 139, 0.35);
      }
      .manual-toggle button {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 999px;
        border: 1px solid transparent;
        background: transparent;
        color: #cbd5e1;
      }
      .manual-toggle button.active {
        background: rgba(99, 102, 241, 0.22);
        border-color: rgba(99, 102, 241, 0.5);
        color: #e2e8f0;
      }
      .manual-mode-tabs {
        display: inline-flex;
        gap: 8px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.35);
        border: 1px solid rgba(100, 116, 139, 0.35);
      }
      .manual-mode-tabs button {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 999px;
        border: 1px solid transparent;
        background: transparent;
        color: #cbd5e1;
      }
      .manual-mode-tabs button.active {
        background: rgba(34, 197, 94, 0.18);
        border-color: rgba(34, 197, 94, 0.45);
        color: #dcfce7;
      }
      .debug-tab-panel {
        display: none;
      }
      .debug-tab-panel.active {
        display: block;
      }
      .debug-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 12px;
      }
      .debug-panel {
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        overflow: hidden;
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(8px);
      }
      .debug-panel .title {
        font-size: 12px;
        color: #94a3b8;
        padding: 10px 14px;
        border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        background: rgba(15, 23, 42, 0.6);
        font-weight: 600;
      }
      .debug-editor {
        min-height: 360px;
        max-height: 420px;
        overflow: auto;
      }
      #reqBodyPanel .debug-editor,
      #respBodyPanel .debug-editor {
        padding: 16px;
        background: rgba(15, 23, 42, 0.4);
      }
      .debug-editor textarea {
        min-height: 330px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 10px;
        padding: 14px;
        color: #e2e8f0;
        font-size: 13px;
        line-height: 1.6;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        resize: vertical;
        transition: all 0.3s ease;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .debug-editor textarea:hover {
        border-color: rgba(139, 151, 252, 0.4);
        background: rgba(15, 23, 42, 0.9);
      }
      .debug-editor textarea:focus {
        outline: none;
        border-color: rgba(139, 151, 252, 0.6);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.15), inset 0 2px 8px rgba(0, 0, 0, 0.2);
        background: rgba(15, 23, 42, 1);
      }
      .debug-editor textarea::placeholder {
        color: #64748b;
      }
      .debug-editor textarea::-webkit-scrollbar {
        width: 8px;
      }
      .debug-editor textarea::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 4px;
      }
      .debug-editor textarea::-webkit-scrollbar-thumb {
        background: rgba(100, 116, 139, 0.5);
        border-radius: 4px;
      }
      .debug-editor textarea::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 151, 252, 0.6);
      }
      .debug-metrics {
        display: flex;
        gap: 12px;
        align-items: center;
        font-size: 12px;
        color: #64748b;
        margin-top: 8px;
      }
      .hint { 
        font-size: 12px; 
        color: #94a3b8; 
        margin-top: 6px;
      }
      #status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px; /* keep same visual size as doc-actions buttons */
        background: rgba(15, 23, 42, 0.75);
        border: 1px solid rgba(139, 151, 252, 0.35);
        border-radius: 12px;
        font-weight: 500;
        font-size: 13px;
        color: #e2e8f0;
        backdrop-filter: blur(8px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.18);
        line-height: 1;
        white-space: nowrap;
        user-select: none;
        cursor: default;
        min-height: 34px;
        min-width: 112px;
        justify-content: center;
        box-sizing: border-box;
      }
      @keyframes statusPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
      .muted { 
        font-size: 12px; 
        color: #94a3b8; 
      }
      pre {
        background: rgba(15, 23, 42, 0.8);
        color: #e2e8f0;
        padding: 14px;
        border-radius: 10px;
        overflow: auto;
        min-height: 200px;
        line-height: 1.6;
        border: 1px solid rgba(100, 116, 139, 0.3);
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 13px;
        backdrop-filter: blur(12px);
        white-space: pre-wrap;
        word-break: break-word;
      }
      pre::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      pre::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 4px;
      }
      pre::-webkit-scrollbar-thumb {
        background: rgba(100, 116, 139, 0.5);
        border-radius: 4px;
      }
      pre::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 151, 252, 0.6);
      }
      .debug-editor pre {
        min-height: 330px;
        margin: 0;
      }
      #output {
        flex: 1 1 auto;
        min-height: 0;
        max-height: 400px;
        overflow-y: auto;
        overflow-x: auto;
      }
      #output.pre-small {
        max-height: 400px;
        overflow-y: auto;
        overflow-x: auto;
      }
      .chart {
        background: rgba(15, 23, 42, 0.4);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 14px;
        padding: 16px;
        backdrop-filter: blur(8px);
      }
      .chart .bar {
        display: grid;
        grid-template-columns: 140px 1fr 70px;
        gap: 12px;
        align-items: center;
        margin: 10px 0;
        font-size: 13px;
        color: #cbd5e1;
      }
      .chart .track {
        height: 12px;
        background: rgba(30, 41, 59, 0.6);
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid rgba(99, 102, 241, 0.2);
      }
      .chart .fill {
        height: 100%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 999px;
        width: 0%;
        transition: width 0.6s ease;
        box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
      }
      .log-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      .log-card {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 16px;
        padding: 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(8px);
        transition: all 0.3s ease;
      }
      .log-card:hover {
        border-color: rgba(99, 102, 241, 0.4);
        box-shadow: 0 12px 40px rgba(99, 102, 241, 0.2);
      }
      .log-card .title {
        color: #94a3b8;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .log-card .value {
        font-size: 36px;
        font-weight: 700;
        background: linear-gradient(135deg, #e2e8f0 0%, #a5b4fc 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 600;
        border: 1px solid;
      }
      .chip.green { background: rgba(34, 197, 94, 0.15); color: #4ade80; border-color: rgba(34, 197, 94, 0.3); }
      .chip.blue { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border-color: rgba(59, 130, 246, 0.3); }
      .chip.orange { background: rgba(249, 115, 22, 0.15); color: #fb923c; border-color: rgba(249, 115, 22, 0.3); }
      .chip.gray { background: rgba(148, 163, 184, 0.15); color: #94a3b8; border-color: rgba(148, 163, 184, 0.3); }
      .log-trend {
        display: flex;
        align-items: flex-end;
        gap: 8px;
        height: 70px;
        margin-top: 12px;
        padding: 12px 12px 10px;
        border-radius: 14px;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.55) 0%, rgba(30, 41, 59, 0.45) 100%);
        border: 1px solid rgba(100, 116, 139, 0.25);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.25);
      }
      .log-trend .bar {
        flex: 1 1 0;
        border-radius: 10px 10px 8px 8px;
        min-height: 8px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.22);
        animation: trendGrow 420ms cubic-bezier(0.16, 1, 0.3, 1);
        transform-origin: bottom;
      }
      @keyframes trendGrow {
        from { transform: scaleY(0.65); opacity: 0.65; }
        to { transform: scaleY(1); opacity: 1; }
      }
      .log-trend .bar::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(180deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.06) 45%, rgba(255,255,255,0) 100%);
        pointer-events: none;
      }
      .log-trend .bar.hit {
        background: linear-gradient(180deg, rgba(99, 102, 241, 0.95) 0%, rgba(139, 92, 246, 0.95) 100%);
      }
      .log-trend .bar.gen {
        background: linear-gradient(180deg, rgba(34, 197, 94, 0.95) 0%, rgba(22, 163, 74, 0.95) 100%);
      }
      .log-trend .bar.err {
        background: linear-gradient(180deg, rgba(245, 158, 11, 0.95) 0%, rgba(217, 119, 6, 0.95) 100%);
      }
      .log-table {
        width: 100%;
        border-collapse: collapse;
      }
      .log-table th, .log-table td {
        padding: 14px 18px;
        border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        font-size: 13px;
        text-align: left;
        color: #cbd5e1;
      }

      /* --- Responsive Layouts --- */
      @media (max-width: 1280px) {
        .main {
          max-width: 1200px;
        }
        .quick-grid {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        .api-toolbar {
          grid-template-columns: 1fr 1fr auto;
        }
        .api-toolbar .scene-filter {
          grid-column: span 2;
        }
      }

      @media (max-width: 1024px) {
        .main {
          padding: 20px;
        }
        .topbar {
          flex-wrap: wrap;
          gap: 12px;
          padding: 12px 18px;
        }
        .nav {
          flex-wrap: wrap;
          justify-content: center;
        }
        .grid-2,
        .doc-grid,
        .debug-layout,
        .log-cards {
          grid-template-columns: 1fr;
        }
        .api-card {
          grid-template-columns: 1fr;
        }
        .api-actions {
          flex-direction: row;
          flex-wrap: wrap;
          min-width: 0;
        }
        .api-actions button {
          width: auto;
          flex: 1 1 160px;
        }
        .debug-topbar {
          flex-wrap: wrap;
          gap: 10px;
        }
        .debug-url-wrap {
          flex: 1 1 100%;
        }
        #sendMockBtn {
          width: 100%;
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        .main {
          padding: 16px;
        }
        .hero {
          padding: 36px 20px;
        }
        .hero h1 {
          font-size: 34px;
        }
        .quick-grid {
          grid-template-columns: 1fr 1fr;
        }
        .api-toolbar {
          grid-template-columns: 1fr;
        }
        .api-toolbar .scene-filter {
          grid-column: span 1;
        }
        .api-url {
          flex-direction: column;
          align-items: stretch;
        }
        .api-url button {
          width: 100%;
        }
        .debug-tabs {
          flex-wrap: wrap;
          gap: 6px;
        }
        .debug-meta {
          flex-wrap: wrap;
          gap: 6px;
          justify-content: flex-start;
        }
        .log-table th:nth-child(4),
        .log-table td:nth-child(4) {
          display: none;
        }
      }

      @media (max-width: 520px) {
        .hero h1 {
          font-size: 28px;
        }
        .quick-grid {
          grid-template-columns: 1fr;
        }
        .section-title {
          font-size: 18px;
        }
        .api-card {
          padding: 16px;
        }
        .api-actions button {
          flex: 1 1 100%;
        }
        .debug-editor textarea,
        .debug-editor pre {
          min-height: 220px;
        }
        .log-table th:nth-child(3),
        .log-table td:nth-child(3) {
          display: none;
        }
      }
      .log-table th {
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 11px;
        background: rgba(15, 23, 42, 0.6);
      }
      .log-row:hover {
        background: rgba(99, 102, 241, 0.1);
      }
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        display: inline-block;
      }
      .dot-green { background: #22c55e; box-shadow: 0 0 8px rgba(34,197,94,0.5); }
      .dot-blue { background: #3b82f6; box-shadow: 0 0 8px rgba(59,130,246,0.5); }
      .dot-red { background: #ef4444; box-shadow: 0 0 8px rgba(239,68,68,0.5); }
      .dot-orange { background: #f97316; box-shadow: 0 0 8px rgba(249,115,22,0.5); }
      .dot-gray { background: #9ca3af; }
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 5px 10px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 700;
        border: 1px solid transparent;
      }
      .badge.gen { background: rgba(239, 68, 68, 0.15); color: #f87171; border-color: rgba(239, 68, 68, 0.3); }
      .badge.hit { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border-color: rgba(59, 130, 246, 0.3); }
      .badge.err { background: rgba(220, 38, 38, 0.15); color: #ef4444; border-color: rgba(220, 38, 38, 0.3); }
      .badge.fail { background: rgba(249, 115, 22, 0.15); color: #fb923c; border-color: rgba(249, 115, 22, 0.3); }
      .badge.upload { background: rgba(148, 163, 184, 0.15); color: #94a3b8; border-color: rgba(148, 163, 184, 0.3); }
      .action-btn {
        border: 1px solid rgba(100, 116, 139, 0.4);
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
        color: #cbd5e1;
        font-size: 12px;
        padding: 11px 16px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(8px);
        font-weight: 600;
        position: relative;
        overflow: hidden;
      }
      .action-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s;
      }
      .action-btn:hover::before {
        left: 100%;
      }
      .action-btn:hover {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 1) 100%);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
        transform: translateX(4px);
      }
      .action-btn:active {
        transform: translateX(2px);
      }
      .api-actions .action-btn {
        justify-content: flex-start;
      }
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.2s ease;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .modal.open { display: flex; }
      .modal .content {
        width: min(980px, 92vw);
        max-height: 85vh;
        overflow: auto;
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(12px);
      }
      /* ç¡®ä¿æ‰‹åŠ¨å½•å…¥æ¨¡æ€æ¡†çš„ä¿å­˜æŒ‰é’®åŒºåŸŸå§‹ç»ˆå¯è§ */
      #manualModal .content > .row:last-child {
        position: sticky;
        bottom: 0;
        background: rgba(30, 41, 59, 0.98);
        padding-top: 12px;
        margin-top: 12px;
        border-top: 1px solid rgba(99, 102, 241, 0.2);
        z-index: 10;
      }
      .modal .content pre {
        min-height: 160px;
        max-height: 260px;
      }
      .modal textarea {
        min-height: 160px;
        max-height: 300px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
      /* Tiny toast */
      .toast {
        position: fixed;
        top: 18px;
        right: 18px;
        left: auto;
        bottom: auto;
        transform: translateY(-6px);
        padding: 10px 14px;
        border-radius: 12px;
        background: rgba(16, 185, 129, 0.16);
        border: 1px solid rgba(74, 222, 128, 0.45);
        color: rgba(220, 252, 231, 0.95);
        font-size: 13px;
        font-weight: 600;
        backdrop-filter: blur(12px);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(74, 222, 128, 0.18) inset;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.18s ease, transform 0.18s ease;
        z-index: 2000;
        max-width: min(420px, calc(100vw - 36px));
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
      .toast.toast--success {
        background: rgba(16, 185, 129, 0.16);
        border-color: rgba(74, 222, 128, 0.45);
        color: rgba(220, 252, 231, 0.95);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35), 0 0 24px rgba(34, 197, 94, 0.12);
      }
      /* Copy success: transparent (neutral) */
      .toast.toast--copy {
        background: rgba(15, 23, 42, 0.62);
        border-color: rgba(139, 151, 252, 0.26);
        color: rgba(226, 232, 240, 0.92);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
      }
      .toast.toast--error {
        background: rgba(239, 68, 68, 0.14);
        border-color: rgba(248, 113, 113, 0.45);
        color: rgba(254, 226, 226, 0.95);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35), 0 0 24px rgba(239, 68, 68, 0.12);
      }
      /* Confirm Dialog Styles */
      .confirm-dialog {
        width: min(460px, 92vw);
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%);
        border: 1px solid rgba(100, 116, 139, 0.4);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        backdrop-filter: blur(20px);
        animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.96);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .confirm-header {
        padding: 28px 28px 24px;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 41, 59, 0.4) 100%);
        border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        position: relative;
        text-align: center;
      }
      .confirm-icon-wrap {
        display: flex;
        justify-content: center;
        margin-bottom: 16px;
      }
      .confirm-icon {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.15) 100%);
        border: 2px solid rgba(239, 68, 68, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        color: #fca5a5;
        box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
      .confirm-title {
        font-size: 20px;
        font-weight: 700;
        color: #f1f5f9;
        letter-spacing: -0.02em;
      }
      .confirm-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(100, 116, 139, 0.3);
        color: #94a3b8;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .confirm-close:hover {
        background: rgba(30, 41, 59, 0.9);
        border-color: rgba(139, 151, 252, 0.5);
        color: #e2e8f0;
        transform: rotate(90deg);
      }
      .confirm-body {
        padding: 24px 28px;
      }
      .confirm-message {
        font-size: 15px;
        line-height: 1.7;
        color: #cbd5e1;
        text-align: center;
      }
      .confirm-footer {
        padding: 20px 28px 28px;
        display: flex;
        gap: 12px;
        justify-content: center;
      }
      .confirm-btn {
        flex: 1;
        max-width: 180px;
        padding: 12px 24px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border: 1px solid transparent;
      }
      .confirm-btn span {
        font-size: 16px;
        opacity: 0.9;
      }
      .confirm-btn-cancel {
        background: linear-gradient(135deg, rgba(71, 85, 105, 0.9) 0%, rgba(51, 65, 85, 0.9) 100%);
        border-color: rgba(100, 116, 139, 0.5);
        color: #e2e8f0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .confirm-btn-cancel:hover {
        background: linear-gradient(135deg, rgba(71, 85, 105, 1) 0%, rgba(51, 65, 85, 1) 100%);
        border-color: rgba(139, 151, 252, 0.6);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      .confirm-btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        border-color: rgba(239, 68, 68, 0.7);
        color: #fff;
        box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
      }
      .confirm-btn-danger:hover {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        border-color: rgba(239, 68, 68, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 6px 24px rgba(239, 68, 68, 0.5);
      }
      .confirm-btn:active {
        transform: translateY(0);
      }
      .pre-small {
        min-height: 120px;
        max-height: 400px;
        white-space: pre-wrap;
        word-break: break-word;
        overflow: auto;
      }
      /* ç¡®ä¿ #output çš„æ ·å¼ä¼˜å…ˆçº§æ›´é«˜ */
      #output.pre-small {
        max-height: 400px !important;
        overflow-y: auto !important;
        overflow-x: auto !important;
      }
      details {
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        padding: 12px 14px;
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(8px);
        transition: all 0.3s ease;
      }
      details:hover {
        border-color: rgba(99, 102, 241, 0.3);
        background: rgba(15, 23, 42, 0.6);
      }
      details summary {
        cursor: pointer;
        font-weight: 600;
        color: #e2e8f0;
        list-style: none;
      }
      details summary::-webkit-details-marker {
        display: none;
      }
      details[open] {
        border-color: rgba(99, 102, 241, 0.4);
      }
      .item {
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        padding: 16px;
        margin-top: 12px;
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(8px);
      }
      .item h3 {
        margin: 0 0 8px;
        font-size: 16px;
        color: #e2e8f0;
      }
      .item .meta {
        font-size: 12px;
        color: #94a3b8;
        margin-bottom: 8px;
        word-break: break-all;
      }
      .pill {
        display: inline-block;
        font-size: 11px;
        background: rgba(99, 102, 241, 0.2);
        color: #a5b4fc;
        padding: 5px 12px;
        border-radius: 6px;
        margin-right: 6px;
        margin-bottom: 6px;
        border: 1px solid rgba(139, 151, 252, 0.35);
        font-weight: 600;
        letter-spacing: 0.3px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .label { 
        font-size: 12px; 
        color: #94a3b8; 
        margin-bottom: 6px; 
        font-weight: 500;
      }
      textarea {
        min-height: 180px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
      .hidden { display: none; }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <img class="brand-logo" src="/logo.png" alt="Redtea Mobile" />
      </div>
      <nav class="nav">
        <span class="active" data-tab="home">é¦–é¡µ</span>
        <span data-tab="doc">æŽ¥å£æ–‡æ¡£</span>
        <span data-tab="api">æŽ¥å£ç®¡ç†</span>
        <span data-tab="scene">åœºæ™¯ç®¡ç†</span>
        <span data-tab="debug">åœ¨çº¿è°ƒè¯•</span>
        <span data-tab="logs">è¯·æ±‚æ—¥å¿—</span>
      </nav>
    </header>
    <main class="main">
      <section class="hero" id="home">
        <div class="hero-content">
          <div class="ai-badge">AI-Powered Mock System</div>
          <h1>Redtea Smart Mock System</h1>
          <p class="tagline">AIé©±åŠ¨çš„æŽ¥å£æ¨¡æ‹Ÿå¹³å°ï¼Œè®©æŽ¥å£æ¨¡æ‹ŸåƒèŠå¤©ä¸€æ ·ç®€å•</p>
          <p class="subtitle">ä¸Šä¼ æŽ¥å£æ–‡æ¡£ï¼Œæ™ºèƒ½è§£æžå¹¶è‡ªåŠ¨ç”Ÿæˆ Mock æœåŠ¡ï¼Œæ”¯æŒå‚æ•°æ ¡éªŒä¸ŽåŠ¨æ€å“åº”ï¼Œè®©æŽ¥å£è”è°ƒæ•ˆçŽ‡æå‡ 10 å€</p>
        </div>
      </section>
      <div class="section-title">ðŸš€ å¿«é€Ÿå¼€å§‹</div>
      <div class="quick-grid">
        <div class="quick" data-jump="doc">
          <div class="icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">ðŸ“„</div>
          <div class="title">æŽ¥å£æ–‡æ¡£ç®¡ç†</div>
          <div class="desc">ä¸Šä¼ å¹¶è§£æžæŽ¥å£æ–‡æ¡£</div>
        </div>
        <div class="quick" data-jump="api">
          <div class="icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">ðŸ—‚ï¸</div>
          <div class="title">æŽ¥å£ç®¡ç†</div>
          <div class="desc">æŸ¥çœ‹ä¸Žé…ç½®æŽ¥å£å®šä¹‰</div>
        </div>
        <div class="quick" data-jump="scene">
          <div class="icon" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);">âš¡</div>
          <div class="title">åœºæ™¯ç®¡ç†</div>
          <div class="desc">é…ç½®è¯·æ±‚ä¸Žåœºæ™¯</div>
        </div>
        <div class="quick" data-jump="debug">
          <div class="icon" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">ðŸ§ª</div>
          <div class="title">åœ¨çº¿è°ƒè¯•</div>
          <div class="desc">å®žæ—¶è°ƒè¯• Mock æŽ¥å£</div>
        </div>
        <div class="quick" data-jump="logs">
          <div class="icon" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">ðŸ“œ</div>
          <div class="title">è¯·æ±‚æ—¥å¿—</div>
          <div class="desc">æŸ¥çœ‹ Mock è¯·æ±‚è®°å½•</div>
        </div>
      </div>

      <section id="doc" class="hidden">
        <div class="section-title">æŽ¥å£æ–‡æ¡£ç®¡ç†</div>
        <div class="doc-grid">
          <div class="doc-card">
            <div class="doc-title">
              <div class="icon">âš™ï¸</div>
              é…ç½®ä¸Žç”Ÿæˆ
            </div>
            <input id="endpoint" class="grow" type="hidden" value="http://localhost:8080/parse/endpoint" />
            <div class="label" style="margin-top: 0;">é€‰æ‹©åœºæ™¯ï¼ˆå¿…é€‰ï¼‰</div>
            <select id="sceneSelect">
              <option value="">è¯·é€‰æ‹©åœºæ™¯</option>
            </select>
            <div class="hint">å¿…é¡»å…ˆé€‰æ‹©åœºæ™¯åŽæ‰èƒ½å¯¼å…¥æŽ¥å£æ–‡ä»¶</div>
            <div class="label" style="margin-top: 0;">ä¸Šä¼ æ–‡æ¡£ï¼ˆDocumentï¼‰</div>
            <div class="upload-area" id="uploadArea">
              <div class="icon">ðŸ“</div>
              <div class="upload-text">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
              <div class="upload-hint">æ”¯æŒ Word (.doc/.docx) å’Œ PDF æ ¼å¼æ–‡æ¡£</div>
              <input id="fileInput" type="file" accept=".doc,.docx,.pdf" />
              <label for="fileInput" class="custom-file-upload doc-btn-green">
                <span>é€‰æ‹©æ–‡ä»¶</span>
              </label>
              <div id="fileNameDisplay" class="file-name-display"></div>
            </div>
            <button id="sendBtn" class="btn-primary doc-btn-blue" style="width:100%; margin-top: 12px;">âœ¨ ç”Ÿæˆ Mock</button>
            <div class="progress-wrap" id="uploadProgress">
              <div class="progress-bar"></div>
            </div>
            <div class="doc-actions">
              <button id="copyBtn" class="btn-outline doc-action-btn" disabled>ðŸ“‹ å¤åˆ¶è¿”å›ž</button>
              <button id="refreshBtn" class="btn-outline-gray doc-action-btn">ðŸ”„ åˆ·æ–°åŽ†å²</button>
              <span class="hint doc-action-btn" id="status">ç­‰å¾…ä¸Šä¼ </span>
            </div>
          </div>
          <div class="doc-card">
            <div class="doc-title">
              <div class="icon">ðŸ“¡</div>
              æŽ¥å£è¿”å›žï¼ˆåŽŸå§‹ï¼‰
            </div>
            <pre id="output" class="pre-small">{}</pre>
          </div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row">
            <strong>å·²ä¸Šä¼ æ–‡æ¡£</strong>
            <span class="muted">æ”¯æŒä¸‹è½½åŽŸå§‹æ–‡ä»¶</span>
          </div>
          <div id="docs"></div>
        </div>
      </section>

      <section id="api" class="hidden">
        <div class="section-title">æŽ¥å£ç®¡ç†</div>
        <div class="api-toolbar">
          <div class="search">
            ðŸ”
            <input id="apiSearch" type="text" placeholder="æœç´¢ API è·¯å¾„ / æè¿° / MockID..." />
          </div>
          <div class="summary">å…±æ‰¾åˆ° <span id="apiCount">0</span> ä¸ª Mock æŽ¥å£</div>
          <div class="scene-filter">
            ðŸ§©
            <select id="apiSceneFilter">
              <option value="">å…¨éƒ¨åœºæ™¯</option>
            </select>
          </div>
          <button id="manualCreateBtn" class="secondary">+ æ‰‹åŠ¨å½•å…¥</button>
        </div>
        <div id="history"></div>
      </section>

      <section id="debug" class="hidden">
        <div class="section-title">åœ¨çº¿è°ƒè¯•</div>
        <div class="debug-topbar">
          <div class="debug-url-wrap">
            <select id="debugMethodSelect" class="debug-method" style="display: none;">
              <option value="POST" selected>POST</option>
              <option value="GET">GET</option>
            </select>
            <div class="method-toggle" id="methodToggle">
              <button type="button" class="method-pill active" data-method="POST">POST</button>
              <button type="button" class="method-pill" data-method="GET">GET</button>
            </div>
            <div class="debug-divider" aria-hidden="true"></div>
            <input id="mockUrl" class="debug-url" placeholder="http://localhost:8080/parse/mock/{id}" />
          </div>
          <button id="sendMockBtn" class="btn-primary">
            <span style="font-size: 16px;">â–¶</span>
            å‘é€è¯·æ±‚
          </button>
        </div>

        <div class="debug-layout">
          <div class="debug-card">
            <div class="debug-card-header">
              <div class="debug-card-title">
                Request / è¯·æ±‚åŒº
              </div>
            </div>
            <div class="debug-tabs">
              <span class="active" data-req-tab="body">Body (JSON)</span>
              <span data-req-tab="headers">Headers</span>
              <span data-req-tab="query">Query Params</span>
            </div>
            <div class="required-list" id="ruleHint"></div>
            <div id="reqBodyPanel" class="debug-tab-panel active">
              <div class="debug-editor">
                <textarea id="mockBody"></textarea>
              </div>
            </div>
            <div id="reqHeadersPanel" class="debug-tab-panel">
              <div class="debug-editor">
                <table class="kv-table">
                  <thead>
                    <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                  </thead>
                  <tbody id="headersTable"></tbody>
                </table>
              </div>
              <div class="kv-actions">
                <button id="addHeaderRow" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
              </div>
            </div>
            <div id="reqQueryPanel" class="debug-tab-panel">
              <div class="debug-editor">
                <table class="kv-table">
                  <thead>
                    <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                  </thead>
                  <tbody id="queryTable"></tbody>
                </table>
              </div>
              <div class="kv-actions">
                <button id="addQueryRow" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
              </div>
            </div>
          </div>

          <div class="debug-card">
            <div class="debug-card-header">
              <div class="debug-card-title">
                Response / å“åº”ç»“æžœ
              </div>
              <div class="debug-meta">
                <span id="debugStatus">Status: -</span>
                <span class="ok" id="debugTime">Time: -</span>
              </div>
            </div>
            <div class="debug-tabs">
              <span class="active" data-resp-tab="body">Response Body</span>
              <span data-resp-tab="headers">Response Headers</span>
            </div>
            <div id="respBodyPanel" class="debug-tab-panel active">
              <div class="debug-editor" style="position: relative;">
                <pre id="mockResponse">{}</pre>
                <div id="aiLoadingOverlay" class="ai-loading-overlay">
                  <div class="ai-loading-title">ðŸ¤– è°ƒç”¨AIç”ŸæˆåŠ¨æ€å“åº”ä¸­...</div>
                  <div class="ai-progress-track">
                    <div class="ai-progress-bar"></div>
                    <div class="ai-horse">ðŸŽ</div>
                  </div>
                </div>
              </div>
            </div>
            <div id="respHeadersPanel" class="debug-tab-panel">
              <div class="debug-editor">
                <table class="kv-table">
                  <thead>
                    <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th></tr>
                  </thead>
                  <tbody id="responseHeadersTable"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="debug-curl">
          <div class="header">
            <div>Generated cURL</div>
            <button id="copyCurlBtn" class="btn-outline">å¤åˆ¶å‘½ä»¤</button>
          </div>
          <pre id="debugCurl">{}</pre>
        </div>
      </section>

      <section id="scene" class="hidden">
        <div class="section-title">åœºæ™¯ç®¡ç†</div>
        <div class="grid-2">
          <div class="card">
            <div class="row">
              <strong>åœºæ™¯åˆ—è¡¨</strong>
              <span class="muted">ç‚¹å‡»è¯¦æƒ…æŸ¥çœ‹åœºæ™¯æŽ¥å£</span>
            </div>
            <div id="sceneList" class="scene-list"></div>
          </div>
          <div class="card">
            <div class="row">
              <strong id="sceneFormTitle">æ–°å¢žåœºæ™¯</strong>
              <span class="muted">ç®€å•æè¿°ä¸šåŠ¡åœºæ™¯</span>
            </div>
            <div style="margin-top: 12px;">
              <div class="label">åœºæ™¯åç§°</div>
              <input id="sceneNameInput" type="text" placeholder="ä¾‹å¦‚ï¼šå¼€æˆ·åŠžç†ã€çŠ¶æ€æŸ¥è¯¢" />
            </div>
            <div style="margin-top: 12px;">
              <div class="label">åœºæ™¯æè¿°</div>
              <textarea id="sceneDescInput" placeholder="ç®€å•æè¿°è¯¥åœºæ™¯ç”¨é€”"></textarea>
            </div>
            <div style="margin-top: 12px;">
              <div class="label">åœºæ™¯è§„åˆ™å…³é”®è¯</div>
              <textarea id="sceneKeywordsInput" placeholder="å¤šä¸ªå…³é”®è¯ç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šorder,profile,download"></textarea>
              <div class="hint">ç”¨äºŽæŽ¥å£è¯†åˆ«ï¼›ä¼šä¸Žç³»ç»Ÿé»˜è®¤å…³é”®è¯åˆå¹¶</div>
            </div>
            <div class="row" style="margin-top: 12px; justify-content:flex-end;">
              <button id="sceneCancelBtn" class="secondary hidden">å–æ¶ˆç¼–è¾‘</button>
              <button id="sceneSaveBtn" class="btn-primary">ä¿å­˜åœºæ™¯</button>
            </div>
          </div>
        </div>
      </section>

      <section id="logs" class="hidden">
        <div class="section-title">è¯·æ±‚æ—¥å¿—</div>
        <div class="card">
          <div class="row">
            <span class="muted">ç»Ÿè®¡ï¼ˆç´¯è®¡ / 24å°æ—¶ï¼‰</span>
            <button id="refreshLogsBtn" class="secondary">åˆ·æ–°æ—¥å¿—</button>
          </div>
          <div class="log-cards" style="margin-top: 10px;">
            <div class="log-card">
              <div>
                <div class="title">ä»Šæ—¥ç´¯è®¡è¯·æ±‚</div>
                <div class="value" id="statTotal">0</div>
                <div style="margin-top: 6px;">
                  <span class="chip green">ä¸Šä¼  <span id="statUpload">0</span></span>
                  <span class="chip blue">ç¼“å­˜ <span id="statHit">0</span></span>
                </div>
              </div>
              <div class="chart" style="width:96px;height:96px;border-radius:999px;border:10px solid #fee2e2;border-top-color:#dc2626;border-right-color:#ef4444;display:flex;align-items:center;justify-content:center;">
                <span style="color:#dc2626;font-weight:700;font-size:12px;">Running</span>
              </div>
            </div>
            <div class="log-card" style="flex-direction:column;align-items:stretch;">
              <div class="row" style="justify-content:space-between;">
                <div>
                  <div class="title">24å°æ—¶è¶‹åŠ¿</div>
                  <div class="muted">ç³»ç»Ÿè´Ÿè½½æƒ…å†µæ¦‚è§ˆ</div>
                </div>
                <div class="muted" id="statDelta">+0%</div>
              </div>
              <div id="logTrend" class="log-trend"></div>
            </div>
          </div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row">
            <div class="label">æŽ¥å£ç»´åº¦ç»Ÿè®¡ï¼ˆä»Šæ—¥ï¼‰</div>
          </div>
          <div id="endpointTodayStats" class="chart"></div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row">
            <div class="label">æŽ¥å£ç»´åº¦ç»Ÿè®¡ï¼ˆè¿‘7å¤©ï¼‰</div>
          </div>
          <div id="endpointWeekStats" class="chart"></div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row">
            <div class="label">åœºæ™¯ç»´åº¦ç»Ÿè®¡ï¼ˆä»Šæ—¥ï¼‰</div>
          </div>
          <div id="sceneTodayStats" class="chart"></div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row">
            <div class="label">åœºæ™¯ç»´åº¦ç»Ÿè®¡ï¼ˆè¿‘7å¤©ï¼‰</div>
          </div>
          <div id="sceneWeekStats" class="chart"></div>
        </div>
        <div class="card" style="margin-top: 16px;">
          <div class="row" style="justify-content:space-between;">
            <div class="label">æœ€è¿‘50æ¡æ“ä½œæ—¥å¿—</div>
            <div class="muted" id="logUpdatedAt">æœ€åŽæ›´æ–° -</div>
          </div>
          <table class="log-table">
            <thead>
              <tr>
                <th>çŠ¶æ€</th>
                <th>ç±»åž‹ (Type)</th>
                <th>æºæ–‡ä»¶ (Source)</th>
                <th>æ¶ˆæ¯ (Message)</th>
                <th>æ—¶é—´</th>
                <th style="text-align:right;">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="logTableBody"></tbody>
          </table>
        </div>
      </section>

      <div id="logModal" class="modal">
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="label">æ—¥å¿—è¯¦æƒ…</div>
            <button id="closeLogModal" class="secondary">å…³é—­</button>
          </div>
          <pre id="logModalContent">{}</pre>
        </div>
      </div>

      <div id="jsonModal" class="modal">
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="label">æŽ¥å£ JSON è¯¦æƒ…</div>
            <button id="closeJsonModal" class="secondary">å…³é—­</button>
          </div>
          <div class="grid" style="margin-top: 8px;">
            <div>
              <div class="label">è¯·æ±‚ç¤ºä¾‹</div>
              <pre id="jsonReq">{}</pre>
            </div>
            <div>
              <div class="label">å“åº”ç¤ºä¾‹</div>
              <pre id="jsonResp">{}</pre>
            </div>
          </div>
          <div class="label" style="margin-top: 8px;">é”™è¯¯å“åº”ç¤ºä¾‹</div>
          <pre id="jsonErr">{}</pre>
        </div>
      </div>

      <div id="sceneDetailModal" class="modal">
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="label">åœºæ™¯æŽ¥å£åˆ—è¡¨</div>
            <button id="closeSceneDetailModal" class="secondary">å…³é—­</button>
          </div>
          <div id="sceneDetailMeta" class="muted" style="margin-top: 6px;"></div>
          <div id="sceneDetailList" class="doc-list" style="margin-top: 12px;"></div>
        </div>
      </div>

      <div id="editModal" class="modal">
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="label">ç¼–è¾‘è¯·æ±‚/å“åº”ç¤ºä¾‹</div>
            <button id="closeEditModal" class="secondary">å…³é—­</button>
          </div>
          <div class="grid" style="margin-top: 8px;">
            <div>
              <div class="label">è¯·æ±‚ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
              <textarea id="editReq"></textarea>
            </div>
            <div>
              <div class="label">å“åº”ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
              <textarea id="editResp"></textarea>
            </div>
          </div>
          <div class="label" style="margin-top: 8px;">é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
          <textarea id="editErr"></textarea>
          <div class="row" style="margin-top: 12px; justify-content:flex-end;">
            <button id="saveEditBtn" class="btn-primary">ä¿å­˜ä¿®æ”¹</button>
          </div>
        </div>
      </div>

      <div id="manualModal" class="modal">
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="label">æ‰‹åŠ¨å½•å…¥æŽ¥å£</div>
            <button id="closeManualModal" class="secondary">å…³é—­</button>
          </div>
          <div class="row" style="margin-top: 8px; justify-content:space-between; align-items:center;">
            <div class="manual-mode-tabs">
              <button id="manualModeManual" class="active">æ‰‹åŠ¨å½•å…¥</button>
              <button id="manualModeChat">èŠå¤©æ¨¡å¼</button>
            </div>
            <div class="manual-toggle">
              <button id="manualModeTable" class="active">è¡¨æ ¼</button>
              <button id="manualModeJson">JSON</button>
            </div>
          </div>
          <div class="row" style="margin-top: 8px; justify-content:flex-end;">
          </div>
          <div id="manualChatWrap" class="hidden" style="margin-top: 12px;">
            <div class="label">èŠå¤©è¾“å…¥</div>
            <div id="manualChatHistory" class="card" style="padding: 12px; margin-bottom: 10px; max-height: 160px; overflow:auto;">
              <div class="hint">å¯å¤šè½®è¿½åŠ æè¿°ï¼Œç”Ÿæˆæ—¶ä¼šåˆå¹¶ä¸Šä¸‹æ–‡ã€‚æ”¯æŒä¸Šä¼ æˆ–ç›´æŽ¥ç²˜è´´æˆªå›¾è¯†åˆ«æŽ¥å£ä¿¡æ¯ï¼ˆCtrl+Vï¼‰ã€‚</div>
            </div>
            <div style="position: relative;">
              <textarea id="manualChatInput" placeholder="æè¿°æŽ¥å£ï¼šåç§°ã€è¯·æ±‚æ–¹å¼ã€è¯·æ±‚/å“åº”å­—æ®µã€ç¤ºä¾‹ç­‰ã€‚ä¹Ÿå¯ä»¥ç›´æŽ¥ç²˜è´´æˆªå›¾ï¼ˆCtrl+Vï¼‰æˆ–ä¸Šä¼ å›¾ç‰‡è¯†åˆ«æŽ¥å£ä¿¡æ¯ã€‚"></textarea>
              <div style="position: absolute; top: 8px; right: 8px;">
                <label for="manualChatImageInput" style="cursor: pointer; padding: 4px 8px; background: #f5f5f5; border-radius: 4px; font-size: 12px; display: inline-block;">
                  ðŸ“· ä¸Šä¼ å›¾ç‰‡
                </label>
                <input type="file" id="manualChatImageInput" accept="image/*" style="display: none;" />
              </div>
            </div>
            <div id="manualChatImages" style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px;"></div>
            <div class="row" style="margin-top: 8px; justify-content:flex-end;">
              <button id="manualChatClearBtn" class="secondary">æ¸…ç©ºå¯¹è¯</button>
              <button id="manualChatGenerateBtn" class="btn-primary">ç”Ÿæˆé¢„è§ˆ</button>
            </div>
          </div>
          <div class="grid" style="margin-top: 8px;">
            <div>
              <div class="label">æŽ¥å£æ ‡é¢˜</div>
              <input id="manualTitleInput" type="text" placeholder="ä¾‹å¦‚ï¼šDelete Profile API" />
            </div>
            <div>
              <div class="label">è¯·æ±‚æ–¹å¼</div>
              <select id="manualMethodSelect">
                <option value="POST">POST</option>
                <option value="GET">GET</option>
              </select>
            </div>
          </div>
          <div style="margin-top: 12px;">
            <div class="label">æ‰€å±žåœºæ™¯ï¼ˆå¿…é€‰ï¼‰</div>
            <select id="manualSceneSelect">
              <option value="">è¯·é€‰æ‹©åœºæ™¯</option>
            </select>
          </div>
          <div id="manualTableWrap">
            <div class="grid" style="margin-top: 12px;">
              <div>
                <div class="label">è¯·æ±‚ Headers</div>
                <div class="manual-table">
                  <table class="kv-table">
                    <thead>
                      <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="manualReqHeadersTable"></tbody>
                  </table>
                  <div class="kv-actions">
                    <button id="manualAddReqHeader" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
                  </div>
                </div>
              </div>
              <div>
                <div class="label">è¯·æ±‚ Query</div>
                <div class="manual-table">
                  <table class="kv-table">
                    <thead>
                      <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="manualReqQueryTable"></tbody>
                  </table>
                  <div class="kv-actions">
                    <button id="manualAddReqQuery" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="margin-top: 12px;">
              <div class="label">è¯·æ±‚ Body</div>
              <div class="manual-table">
                <table class="kv-table">
                  <thead>
                    <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                  </thead>
                  <tbody id="manualReqBodyTable"></tbody>
                </table>
                <div class="kv-actions">
                  <button id="manualAddReqBody" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
                </div>
              </div>
            </div>
            <div class="grid" style="margin-top: 12px;">
              <div>
                <div class="label">å“åº” Headers</div>
                <div class="manual-table">
                  <table class="kv-table">
                    <thead>
                      <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="manualRespHeadersTable"></tbody>
                  </table>
                  <div class="kv-actions">
                    <button id="manualAddRespHeader" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
                  </div>
                </div>
              </div>
              <div>
                <div class="label">å“åº” Body</div>
                <div class="manual-table">
                  <table class="kv-table">
                    <thead>
                      <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="manualRespBodyTable"></tbody>
                  </table>
                  <div class="kv-actions">
                    <button id="manualAddRespBody" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="label" style="margin-top: 8px;">é”™è¯¯å“åº”ç¤ºä¾‹</div>
            <div class="manual-table">
              <table class="kv-table">
                <thead>
                  <tr><th>å‚æ•°å</th><th>å‚æ•°å€¼</th><th>æ“ä½œ</th></tr>
                </thead>
                <tbody id="manualErrBodyTable"></tbody>
              </table>
              <div class="kv-actions">
                <button id="manualAddErrBody" class="btn-outline">+ æ·»åŠ å‚æ•°</button>
              </div>
            </div>
          </div>
          <div id="manualJsonWrap" class="hidden">
            <div class="label" style="margin-top: 12px;">è¯·æ±‚ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
            <textarea id="manualReqJson"></textarea>
            <div class="label" style="margin-top: 8px;">å“åº”ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
            <textarea id="manualRespJson"></textarea>
            <div class="label" style="margin-top: 8px;">é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆJSONï¼‰</div>
            <textarea id="manualErrJson"></textarea>
          </div>
          <div style="margin-top: 8px;">
            <div class="label">é”™è¯¯å“åº” HTTP çŠ¶æ€ç </div>
            <input id="manualErrStatusInput" type="text" placeholder="ä¾‹å¦‚ï¼š400 æˆ– 500" />
          </div>
          <div class="label" style="margin-top: 8px;">å¿…å¡«å­—æ®µï¼ˆJSONæ•°ç»„ï¼‰</div>
          <textarea id="manualRequired"></textarea>
          <div class="row" style="margin-top: 12px; justify-content:flex-end;">
            <button id="manualSaveBtn" class="btn-primary">ä¿å­˜æŽ¥å£</button>
          </div>
        </div>
      </div>

      <div id="confirmModal" class="modal">
        <div class="confirm-dialog">
          <div class="confirm-header">
            <div class="confirm-icon-wrap">
              <div class="confirm-icon">âš </div>
            </div>
            <div class="confirm-title" id="confirmTitle">ç¡®è®¤åˆ é™¤æ“ä½œ</div>
            <button id="closeConfirmModal" class="confirm-close">âœ•</button>
          </div>
          <div class="confirm-body">
            <div class="confirm-message" id="confirmMessage"></div>
          </div>
          <div class="confirm-footer">
            <button id="confirmCancelBtn" class="confirm-btn confirm-btn-cancel">
              <span>âœ•</span>
              å–æ¶ˆ
            </button>
            <button id="confirmOkBtn" class="confirm-btn confirm-btn-danger">
              <span>âœ“</span>
              ç¡®è®¤åˆ é™¤
            </button>
          </div>
        </div>
      </div>

      <div id="toast" class="toast" role="status" aria-live="polite"></div>
    </main>

    <script>
      const endpointInput = document.getElementById("endpoint");
      const fileInput = document.getElementById("fileInput");
      const sendBtn = document.getElementById("sendBtn");
      const copyBtn = document.getElementById("copyBtn");
      const refreshBtn = document.getElementById("refreshBtn");
      const output = document.getElementById("output");
      const status = document.getElementById("status");
      const items = document.getElementById("items");
      const history = document.getElementById("history");
      const uploadProgress = document.getElementById("uploadProgress");
      const docs = document.getElementById("docs");
      const mockUrlInput = document.getElementById("mockUrl");
      const mockBody = document.getElementById("mockBody");
      const mockResponse = document.getElementById("mockResponse");
      const aiLoadingOverlay = document.getElementById("aiLoadingOverlay");
      const sendMockBtn = document.getElementById("sendMockBtn");
      const ruleHint = document.getElementById("ruleHint");
      const debugMethodSelect = document.getElementById("debugMethodSelect");
      const methodToggle = document.getElementById("methodToggle");
      const debugCurl = document.getElementById("debugCurl");
      const headersTable = document.getElementById("headersTable");
      const queryTable = document.getElementById("queryTable");
      const responseHeadersTable = document.getElementById("responseHeadersTable");
      const addHeaderRow = document.getElementById("addHeaderRow");
      const addQueryRow = document.getElementById("addQueryRow");
      const reqBodyPanel = document.getElementById("reqBodyPanel");
      const reqHeadersPanel = document.getElementById("reqHeadersPanel");
      const reqQueryPanel = document.getElementById("reqQueryPanel");
      const respBodyPanel = document.getElementById("respBodyPanel");
      const respHeadersPanel = document.getElementById("respHeadersPanel");
      const debugStatus = document.getElementById("debugStatus");
      const debugTime = document.getElementById("debugTime");
      const debugSize = document.getElementById("debugSize");
      const copyCurlBtn = document.getElementById("copyCurlBtn");
      const apiSearch = document.getElementById("apiSearch");
      const apiCount = document.getElementById("apiCount");
      const apiSceneFilter = document.getElementById("apiSceneFilter");
      const manualCreateBtn = document.getElementById("manualCreateBtn");
      const refreshLogsBtn = document.getElementById("refreshLogsBtn");
      const logTableBody = document.getElementById("logTableBody");
      const logUpdatedAt = document.getElementById("logUpdatedAt");
      const statTotal = document.getElementById("statTotal");
      const statUpload = document.getElementById("statUpload");
      const statHit = document.getElementById("statHit");
      const statDelta = document.getElementById("statDelta");
      const logTrend = document.getElementById("logTrend");
      const logModal = document.getElementById("logModal");
      const closeLogModal = document.getElementById("closeLogModal");
      const logModalContent = document.getElementById("logModalContent");
      const jsonModal = document.getElementById("jsonModal");
      const closeJsonModal = document.getElementById("closeJsonModal");
      const jsonReq = document.getElementById("jsonReq");
      const jsonResp = document.getElementById("jsonResp");
      const jsonErr = document.getElementById("jsonErr");
      const editModal = document.getElementById("editModal");
      const closeEditModal = document.getElementById("closeEditModal");
      const confirmModal = document.getElementById("confirmModal");
      const closeConfirmModal = document.getElementById("closeConfirmModal");
      const confirmTitle = document.getElementById("confirmTitle");
      const confirmMessage = document.getElementById("confirmMessage");
      const confirmCancelBtn = document.getElementById("confirmCancelBtn");
      const confirmOkBtn = document.getElementById("confirmOkBtn");
      const editReq = document.getElementById("editReq");
      const editResp = document.getElementById("editResp");
      const editErr = document.getElementById("editErr");
      const saveEditBtn = document.getElementById("saveEditBtn");
      const sceneSelect = document.getElementById("sceneSelect");
      const sceneList = document.getElementById("sceneList");
      const sceneNameInput = document.getElementById("sceneNameInput");
      const sceneDescInput = document.getElementById("sceneDescInput");
      const sceneKeywordsInput = document.getElementById("sceneKeywordsInput");
      const sceneSaveBtn = document.getElementById("sceneSaveBtn");
      const sceneCancelBtn = document.getElementById("sceneCancelBtn");
      const sceneFormTitle = document.getElementById("sceneFormTitle");
      const sceneDetailModal = document.getElementById("sceneDetailModal");
      const closeSceneDetailModal = document.getElementById("closeSceneDetailModal");
      const sceneDetailList = document.getElementById("sceneDetailList");
      const sceneDetailMeta = document.getElementById("sceneDetailMeta");
      const sceneTodayStats = document.getElementById("sceneTodayStats");
      const sceneWeekStats = document.getElementById("sceneWeekStats");
      const manualModal = document.getElementById("manualModal");
      const closeManualModal = document.getElementById("closeManualModal");
      const manualTitleInput = document.getElementById("manualTitleInput");
      const manualMethodSelect = document.getElementById("manualMethodSelect");
      const manualSceneSelect = document.getElementById("manualSceneSelect");
      const manualReqHeadersTable = document.getElementById("manualReqHeadersTable");
      const manualReqQueryTable = document.getElementById("manualReqQueryTable");
      const manualReqBodyTable = document.getElementById("manualReqBodyTable");
      const manualRespHeadersTable = document.getElementById("manualRespHeadersTable");
      const manualRespBodyTable = document.getElementById("manualRespBodyTable");
      const manualErrBodyTable = document.getElementById("manualErrBodyTable");
      const manualErrStatusInput = document.getElementById("manualErrStatusInput");
      const manualReqJson = document.getElementById("manualReqJson");
      const manualRespJson = document.getElementById("manualRespJson");
      const manualErrJson = document.getElementById("manualErrJson");
      const manualTableWrap = document.getElementById("manualTableWrap");
      const manualJsonWrap = document.getElementById("manualJsonWrap");
      const manualModeTable = document.getElementById("manualModeTable");
      const manualModeJson = document.getElementById("manualModeJson");
      const manualModeManual = document.getElementById("manualModeManual");
      const manualModeChat = document.getElementById("manualModeChat");
      const manualChatWrap = document.getElementById("manualChatWrap");
      const manualChatHistory = document.getElementById("manualChatHistory");
      const manualChatInput = document.getElementById("manualChatInput");
      const manualChatGenerateBtn = document.getElementById("manualChatGenerateBtn");
      const manualChatClearBtn = document.getElementById("manualChatClearBtn");
      const manualRequired = document.getElementById("manualRequired");
      const manualSaveBtn = document.getElementById("manualSaveBtn");
      const manualAddReqHeader = document.getElementById("manualAddReqHeader");
      const manualAddReqQuery = document.getElementById("manualAddReqQuery");
      const manualAddReqBody = document.getElementById("manualAddReqBody");
      const manualAddRespHeader = document.getElementById("manualAddRespHeader");
      const manualAddRespBody = document.getElementById("manualAddRespBody");
      const manualAddErrBody = document.getElementById("manualAddErrBody");
      let editingMockId = null;
      let editingSceneId = null;
      const uploadArea = document.getElementById("uploadArea");
      const endpointTodayStats = document.getElementById("endpointTodayStats");
      const endpointWeekStats = document.getElementById("endpointWeekStats");
      let currentMethod = "POST";
      let selectedFile = null;

      function setStatus(text) {
        status.textContent = text;
      }

      let toastTimer = null;
      function showToast(message, type = "success", duration = 1200) {
        const el = document.getElementById("toast");
        if (!el) return;
        el.textContent = message || "";
        el.classList.remove("toast--success", "toast--error", "toast--copy");
        if (type === "error") el.classList.add("toast--error");
        else if (type === "copy") el.classList.add("toast--copy");
        else el.classList.add("toast--success");
        el.classList.add("show");
        if (toastTimer) clearTimeout(toastTimer);
        toastTimer = setTimeout(() => {
          el.classList.remove("show");
        }, duration);
      }

      function setSceneForm(scene) {
        if (!sceneNameInput || !sceneDescInput || !sceneKeywordsInput || !sceneFormTitle || !sceneSaveBtn || !sceneCancelBtn) {
          return;
        }
        if (!scene) {
          editingSceneId = null;
          sceneFormTitle.textContent = "æ–°å¢žåœºæ™¯";
          sceneSaveBtn.textContent = "ä¿å­˜åœºæ™¯";
          sceneNameInput.value = "";
          sceneDescInput.value = "";
          sceneKeywordsInput.value = "";
          sceneCancelBtn.classList.add("hidden");
          return;
        }
        editingSceneId = scene.id;
        sceneFormTitle.textContent = "ç¼–è¾‘åœºæ™¯";
        sceneSaveBtn.textContent = "ä¿å­˜ä¿®æ”¹";
        sceneNameInput.value = scene.name || "";
        sceneDescInput.value = scene.description || "";
        sceneKeywordsInput.value = scene.keywords || "";
        sceneCancelBtn.classList.remove("hidden");
      }

      async function loadScenes(keepSelection = true) {
        if (!sceneList || !sceneSelect) return;
        const currentSelection = keepSelection ? sceneSelect.value : "";
        const apiSelection = keepSelection && apiSceneFilter ? apiSceneFilter.value : "";
        const manualSelection = keepSelection && manualSceneSelect ? manualSceneSelect.value : "";
        try {
          const res = await fetch("/parse/scenes");
          if (!res.ok) return;
          const list = await res.json();
          renderSceneList(Array.isArray(list) ? list : []);
          updateSceneSelect(sceneSelect, Array.isArray(list) ? list : [], currentSelection, "è¯·é€‰æ‹©åœºæ™¯");
          if (apiSceneFilter) {
            // æŽ¥å£ç®¡ç†ä¸­çš„åœºæ™¯é€‰æ‹©é»˜è®¤ä¿æŒ"å…¨éƒ¨åœºæ™¯"ï¼ˆç©ºå€¼ï¼‰ï¼Œä¸è‡ªåŠ¨é€‰æ‹©
            updateSceneSelect(apiSceneFilter, Array.isArray(list) ? list : [], apiSelection, "å…¨éƒ¨åœºæ™¯", true);
          }
          if (manualSceneSelect) {
            updateSceneSelect(manualSceneSelect, Array.isArray(list) ? list : [], manualSelection, "è¯·é€‰æ‹©åœºæ™¯");
          }
        } catch (err) {
          // ignore
        }
      }

      function updateSceneSelect(selectEl, list, selectedId = "", placeholder = "è¯·é€‰æ‹©åœºæ™¯", keepEmpty = false) {
        if (!selectEl) return;
        selectEl.innerHTML = `<option value="">${placeholder}</option>`;
        list.forEach((scene) => {
          const option = document.createElement("option");
          option.value = scene.id;
          option.textContent = scene.name || "æœªå‘½ååœºæ™¯";
          if (selectedId && selectedId === scene.id) {
            option.selected = true;
          }
          selectEl.appendChild(option);
        });
        // å¦‚æžœ keepEmpty ä¸º trueï¼Œä¿æŒä¸ºç©ºï¼ˆç”¨äºŽ"å…¨éƒ¨åœºæ™¯"ï¼‰
        if (!keepEmpty && !selectedId && list.length) {
          const defaultScene = list.find((scene) => String(scene.name || "").includes("é»˜è®¤"));
          if (defaultScene) {
            selectEl.value = defaultScene.id;
          } else if (list.length === 1) {
            selectEl.value = list[0].id;
          }
        }
      }

      function renderSceneList(list) {
        if (!sceneList) return;
        if (!list.length) {
          sceneList.innerHTML = "<div class='hint'>æš‚æ— åœºæ™¯ï¼Œè¯·å…ˆæ–°å¢žåœºæ™¯</div>";
          return;
        }
        sceneList.innerHTML = "";
        list.forEach((scene) => {
          const div = document.createElement("div");
          div.className = "scene-item";
          div.innerHTML = `
            <div>
              <div class="name">${escapeHtml(scene.name || "æœªå‘½ååœºæ™¯")}</div>
              <div class="meta">${escapeHtml(scene.description || "æš‚æ— æè¿°")}</div>
              <div class="meta">å…³é”®è¯: ${escapeHtml(scene.keywords || "-")}</div>
              <div class="meta">åœºæ™¯ID: ${escapeHtml(scene.id || "-")}</div>
            </div>
            <div class="scene-actions">
              <button class="action-btn" data-scene-detail="${escapeHtml(scene.id || "")}">è¯¦æƒ…</button>
              <button class="action-btn" data-scene-edit="${escapeHtml(scene.id || "")}">ç¼–è¾‘</button>
              <button class="action-btn danger" data-scene-delete="${escapeHtml(scene.id || "")}">åˆ é™¤</button>
            </div>
          `;
          sceneList.appendChild(div);
        });

        sceneList.querySelectorAll("[data-scene-detail]").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const id = btn.getAttribute("data-scene-detail");
            if (!id) return;
            await openSceneDetail(id);
          });
        });

        sceneList.querySelectorAll("[data-scene-edit]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-scene-edit");
            const scene = list.find((s) => s.id === id);
            if (scene) {
              setSceneForm(scene);
            }
          });
        });

        sceneList.querySelectorAll("[data-scene-delete]").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const id = btn.getAttribute("data-scene-delete");
            if (!id) return;
            const ok = await openConfirmModal({
              title: "ç¡®è®¤åˆ é™¤",
              message: "ç¡®å®šåˆ é™¤è¯¥åœºæ™¯å—ï¼Ÿè¯¥åœºæ™¯ä¸‹çš„æŽ¥å£å°†å˜ä¸ºæœªå½’ç±»ã€‚",
              okText: "ç¡®è®¤åˆ é™¤",
              danger: true
            });
            if (!ok) return;
            try {
              btn.disabled = true;
              const res = await fetch(`/parse/scenes/${id}`, { method: "DELETE" });
              if (res.ok) {
                setStatus("å·²åˆ é™¤åœºæ™¯");
                showToast("åˆ é™¤æˆåŠŸ", "success");
                setSceneForm(null);
                await loadScenes(false);
                await loadHistory();
              } else {
                setStatus("åˆ é™¤å¤±è´¥");
                showToast("åˆ é™¤å¤±è´¥", "error");
              }
            } catch (err) {
              setStatus("åˆ é™¤å¼‚å¸¸");
              showToast("åˆ é™¤å¼‚å¸¸", "error");
            } finally {
              btn.disabled = false;
            }
          });
        });
      }

      async function openSceneDetail(sceneId) {
        if (!sceneDetailModal || !sceneDetailList) return;
        sceneDetailList.innerHTML = "<div class='hint'>åŠ è½½ä¸­...</div>";
        if (sceneDetailMeta) {
          sceneDetailMeta.textContent = "";
        }
        try {
          const res = await fetch(`/parse/scenes/${sceneId}/endpoints`);
          if (!res.ok) {
            sceneDetailList.innerHTML = "<div class='hint'>åŠ è½½å¤±è´¥</div>";
            return;
          }
          const list = await res.json();
          const items = Array.isArray(list) ? list : [];
          if (sceneDetailMeta) {
            sceneDetailMeta.textContent = `å…± ${items.length} ä¸ªæŽ¥å£`;
          }
          if (!items.length) {
            sceneDetailList.innerHTML = "<div class='hint'>è¯¥åœºæ™¯æš‚æ— æŽ¥å£</div>";
          } else {
            sceneDetailList.innerHTML = items.map((item) => {
              const method = (item.method || "").toUpperCase() || "POST";
              const mockUrl = toAbsoluteUrl(item.mockUrl || "");
              return `
                <div class="doc-item">
                  <div>
                    <div class="name">${escapeHtml(item.title || "API")}</div>
                    <div class="meta">æ–¹æ³•: ${escapeHtml(method)} | ${escapeHtml(mockUrl)}</div>
                  </div>
                  <div>
                    <button class="action-btn" data-copy="${escapeHtml(mockUrl)}">å¤åˆ¶åœ°å€</button>
                  </div>
                </div>
              `;
            }).join("");
            sceneDetailList.querySelectorAll("[data-copy]").forEach((btn) => {
              btn.addEventListener("click", async () => {
                const value = btn.getAttribute("data-copy") || "";
                try {
                  await navigator.clipboard.writeText(value);
                  setStatus("å·²å¤åˆ¶");
                  showToast("å¤åˆ¶æˆåŠŸ", "copy");
                } catch (err) {
                  setStatus("å¤åˆ¶å¤±è´¥");
                  showToast("å¤åˆ¶å¤±è´¥", "error");
                }
              });
            });
          }
        } catch (err) {
          sceneDetailList.innerHTML = "<div class='hint'>åŠ è½½å¼‚å¸¸</div>";
        } finally {
          sceneDetailModal.classList.add("open");
        }
      }

      function openConfirmModal({ title = "è¯·ç¡®è®¤æ“ä½œ", message = "", okText = "ç¡®è®¤", danger = false } = {}) {
        return new Promise((resolve) => {
          if (!confirmModal || !confirmOkBtn || !confirmCancelBtn || !confirmTitle || !confirmMessage) {
            // Fallback (shouldn't happen)
            resolve(false);
            return;
          }
          confirmTitle.textContent = title;
          confirmMessage.textContent = message;
          confirmOkBtn.textContent = okText;
          confirmOkBtn.classList.toggle("danger", !!danger);

          const cleanup = () => {
            confirmModal.classList.remove("open");
            confirmOkBtn.removeEventListener("click", onOk);
            confirmCancelBtn.removeEventListener("click", onCancel);
            if (closeConfirmModal) closeConfirmModal.removeEventListener("click", onCancel);
            confirmModal.removeEventListener("click", onBackdrop);
            document.removeEventListener("keydown", onKeydown);
          };
          const onOk = () => {
            cleanup();
            resolve(true);
          };
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          const onBackdrop = (e) => {
            if (e.target === confirmModal) onCancel();
          };
          const onKeydown = (e) => {
            if (e.key === "Escape") onCancel();
          };

          confirmOkBtn.addEventListener("click", onOk);
          confirmCancelBtn.addEventListener("click", onCancel);
          if (closeConfirmModal) closeConfirmModal.addEventListener("click", onCancel);
          confirmModal.addEventListener("click", onBackdrop);
          document.addEventListener("keydown", onKeydown);
          confirmModal.classList.add("open");
        });
      }

      async function handleSend() {
        const endpoint = endpointInput && endpointInput.value ? endpointInput.value.trim() : "";
        const file = (fileInput && fileInput.files && fileInput.files[0]) || selectedFile;
        const sceneId = sceneSelect ? sceneSelect.value.trim() : "";

        const finalEndpoint = endpoint || "/parse/endpoint";
        if (!sceneId) {
          setStatus("è¯·é€‰æ‹©åœºæ™¯");
          showToast("è¯·å…ˆé€‰æ‹©åœºæ™¯", "error");
          return;
        }
        if (!file) {
          setStatus("è¯·é€‰æ‹©æ–‡æ¡£");
          return;
        }

        sendBtn.disabled = true;
        copyBtn.disabled = true;
        setStatus("è§£æžä¸­...");
        if (uploadProgress) {
          uploadProgress.style.display = "block";
        }
        output.textContent = "{}";
        if (items) {
          items.innerHTML = "";
        }
        if (history) {
          history.innerHTML = "";
        }

        const formData = new FormData();
        formData.append("file", file);
        formData.append("sceneId", sceneId);

        try {
          const res = await fetch(finalEndpoint, {
            method: "POST",
            body: formData
          });
          const text = await res.text();
          const parsed = parseJsonLoose(text);
          if (parsed) {
            output.textContent = JSON.stringify(parsed, null, 2);
            if (parsed && Array.isArray(parsed.items)) {
              renderItems(parsed.items);
            }
          } else {
            output.textContent = prettyPrintFallback(text);
          }
          if (!res.ok) {
            setStatus("è¯·æ±‚å¤±è´¥ï¼š" + res.status);
          } else {
            setStatus("å®Œæˆ");
            copyBtn.disabled = false;
            await loadHistory();
            switchTab("api");
          }
        } catch (err) {
          setStatus("è¯·æ±‚å¼‚å¸¸ï¼š" + err.message);
          output.textContent = "";
        } finally {
          sendBtn.disabled = false;
          if (uploadProgress) {
            uploadProgress.style.display = "none";
          }
        }
      }

      sendBtn.addEventListener("click", handleSend);
      if (fileInput) {
        fileInput.addEventListener("change", () => {
          selectedFile = fileInput.files && fileInput.files.length ? fileInput.files[0] : null;
          const fileNameDisplay = document.getElementById("fileNameDisplay");
          if (selectedFile && fileNameDisplay) {
            fileNameDisplay.textContent = selectedFile.name;
            fileNameDisplay.classList.add("show");
          } else if (fileNameDisplay) {
            fileNameDisplay.classList.remove("show");
          }
        });
      }
      refreshBtn.addEventListener("click", loadHistory);
      sendMockBtn.addEventListener("click", sendMockRequest);
      if (refreshLogsBtn) {
        refreshLogsBtn.addEventListener("click", () => loadLogs(true));
      }
      if (closeLogModal) {
        closeLogModal.addEventListener("click", () => logModal.classList.remove("open"));
      }
      if (closeJsonModal) {
        closeJsonModal.addEventListener("click", () => jsonModal.classList.remove("open"));
      }
      if (closeEditModal) {
        closeEditModal.addEventListener("click", () => editModal.classList.remove("open"));
      }
      if (closeManualModal) {
        closeManualModal.addEventListener("click", () => manualModal.classList.remove("open"));
      }
      if (closeSceneDetailModal) {
        closeSceneDetailModal.addEventListener("click", () => sceneDetailModal.classList.remove("open"));
      }
      if (sceneDetailModal) {
        sceneDetailModal.addEventListener("click", (e) => {
          if (e.target === sceneDetailModal) {
            sceneDetailModal.classList.remove("open");
          }
        });
      }

      if (uploadArea) {
        uploadArea.addEventListener("click", (e) => {
          if (e.target === uploadArea || e.target.closest('.upload-area') && !e.target.closest('.custom-file-upload')) {
            fileInput.click();
          }
        });
        uploadArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          uploadArea.classList.add("dragover");
        });
        uploadArea.addEventListener("dragleave", () => {
          uploadArea.classList.remove("dragover");
        });
        uploadArea.addEventListener("drop", (e) => {
          e.preventDefault();
          uploadArea.classList.remove("dragover");
          const files = e.dataTransfer.files;
          if (files && files.length) {
            selectedFile = files[0];
            const fileNameDisplay = document.getElementById("fileNameDisplay");
            if (fileNameDisplay) {
              fileNameDisplay.textContent = selectedFile.name;
              fileNameDisplay.classList.add("show");
            }
            try {
              fileInput.files = files;
            } catch (err) {
              // ignore assignment errors in some browsers
            }
            handleSend();
          }
        });
      }
      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(output.textContent);
          setStatus("å·²å¤åˆ¶ç»“æžœ");
          showToast("å¤åˆ¶æˆåŠŸ", "copy");
        } catch (err) {
          setStatus("å¤åˆ¶å¤±è´¥");
          showToast("å¤åˆ¶å¤±è´¥", "error");
        }
      });

      function renderItems(list) {
        if (!items) {
          return;
        }
        if (!list.length) {
          return;
        }
        list.forEach((item) => {
          items.appendChild(buildApiCard(item));
        });
      }

      async function loadHistory() {
        history.innerHTML = "";
        if (docs) {
          docs.innerHTML = "";
        }
        try {
          const res = await fetch("/parse/endpoint/history");
          if (!res.ok) {
            console.error("Failed to load history:", res.status, res.statusText);
            return;
          }
          const json = await res.json();
          if (!json || !Array.isArray(json.items)) {
            console.error("Invalid history response:", json);
            return;
          }
          console.log("Loaded history items:", json.items.length);
          renderHistory(json.items);
          renderDocs(json.items);
        } catch (err) {
          console.error("Error loading history:", err);
        }
      }

      function renderHistory(list) {
        history.innerHTML = "";
        if (!list.length) {
          history.innerHTML = "<div class='hint'>æš‚æ— åŽ†å²æ•°æ®</div>";
          if (apiCount) apiCount.textContent = "0";
          return;
        }
        const keyword = (apiSearch ? apiSearch.value.trim().toLowerCase() : "");
        const filtered = keyword
          ? list.filter((item) => {
              const text = `${item.title || ""} ${item.mockUrl || ""} ${item.sourceFileName || ""} ${item.sceneName || ""}`.toLowerCase();
              return text.includes(keyword);
            })
          : list;
        const sceneId = apiSceneFilter ? apiSceneFilter.value.trim() : "";
        const filteredByScene = sceneId
          ? filtered.filter((item) => String(item.sceneId || "") === sceneId)
          : filtered;
        if (apiCount) apiCount.textContent = String(filteredByScene.length);
        filteredByScene.forEach((item) => {
          history.appendChild(buildApiCard(item));
        });
      }

      function renderDocs(itemsList) {
        if (!docs) {
          return;
        }
        const map = new Map();
        itemsList.forEach((item) => {
          if (item.sourceFileId) {
            map.set(item.sourceFileId, item);
          }
        });
        if (!map.size) {
          docs.innerHTML = "<div class='hint'>æš‚æ— ä¸Šä¼ è®°å½•</div>";
          return;
        }
        docs.innerHTML = "";
        const list = document.createElement("div");
        list.className = "doc-list";
        map.forEach((item) => {
          const div = document.createElement("div");
          div.className = "doc-item";
          const downloadUrl = toAbsoluteUrl(item.sourceFileUrl || "");
          div.innerHTML = `
            <div>
              <div class="name">${escapeHtml(item.sourceFileName || "æ–‡ä»¶")}</div>
              <div class="meta">æ–‡ä»¶ID: ${escapeHtml(item.sourceFileId || "-")}</div>
            </div>
            <div>
              ${downloadUrl ? `<a class="action-btn" href="${downloadUrl}" target="_blank">ä¸‹è½½åŽŸå§‹æ–‡ä»¶</a>` : ""}
              <button class="action-btn danger" data-delete-doc="${escapeHtml(item.sourceFileId || "")}">åˆ é™¤</button>
            </div>
          `;
          list.appendChild(div);
        });
        docs.appendChild(list);
        docs.querySelectorAll("[data-delete-doc]").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const fileId = btn.getAttribute("data-delete-doc");
            if (!fileId) return;
            const ok = await openConfirmModal({
              title: "ç¡®è®¤åˆ é™¤",
              message: "ç¡®å®šåˆ é™¤è¯¥æ–‡æ¡£åŠå…¶å…³è”æŽ¥å£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚",
              okText: "ç¡®è®¤åˆ é™¤",
              danger: true
            });
            if (!ok) return;
            try {
              btn.disabled = true;
              const res = await fetch(`/parse/endpoint/file/${fileId}`, { method: "DELETE" });
              if (res.ok) {
                setStatus("å·²åˆ é™¤æ–‡æ¡£");
                showToast("åˆ é™¤æˆåŠŸ", "success");
                await loadHistory();
              } else {
                setStatus("åˆ é™¤å¤±è´¥");
                showToast("åˆ é™¤å¤±è´¥", "error");
              }
            } catch (err) {
              setStatus("åˆ é™¤å¼‚å¸¸");
              showToast("åˆ é™¤å¼‚å¸¸", "error");
            } finally {
              btn.disabled = false;
            }
          });
        });
      }

      function buildApiCard(item) {
        const div = document.createElement("div");
        div.className = "api-card";
        const mockUrl = toAbsoluteUrl(item.mockUrl || "");
        const apiPath = item.apiPath || "";
        const required = Array.isArray(item.requiredFields) ? item.requiredFields : [];
        const downloadUrl = toAbsoluteUrl(item.sourceFileUrl || "");
        const title = item.title || "API";
        const method = (item.method || "").toUpperCase() || (/post/i.test(title) ? "POST" : "GET");
        const isPost = method === "POST";
        div.innerHTML = `
          <div>
            <div class="row">
              <span class="method ${String(method || "").toLowerCase()}">${method}</span>
              <h3>${escapeHtml(title)}</h3>
            </div>
            <div class="api-meta api-meta-source">Source: <span class="api-meta-strong">${escapeHtml(item.sourceFileName || "-")}</span>
              ${downloadUrl ? `<a href="${downloadUrl}" target="_blank">ä¸‹è½½</a>` : ""}
            </div>
            <div class="api-meta">Scene: <span class="api-meta-strong">${escapeHtml(item.sceneName || "-")}</span></div>
            ${apiPath ? `<div class="api-meta">Path: <span class="api-meta-strong">${escapeHtml(apiPath)}</span></div>` : ""}
            <div class="api-url">
              <span>${escapeHtml(mockUrl)}</span>
              <button class="action-btn" data-copy="${mockUrl}">å¤åˆ¶</button>
            </div>
            <div class="api-meta api-meta-title">Required Fields</div>
            <div class="api-meta">${required.map((r) => `<span class="pill">${escapeHtml(formatRequiredFieldLabel(r))}</span>`).join("")}</div>
          </div>
          <div class="api-actions">
            <button class="play" data-use="success"><span style="font-size: 14px;">â–¶</span> è°ƒè¯•æˆåŠŸå“åº”</button>
            <button class="action-btn warn" data-use="error"><span style="font-size: 14px;">âœ–</span> è°ƒè¯•å¤±è´¥å“åº”</button>
            <button class="json" data-json="1"><span style="font-size: 14px;">â‰¡</span> æŸ¥çœ‹ JSON</button>
            <button class="action-btn" data-edit="1"><span style="font-size: 14px;">âœŽ</span> ç¼–è¾‘é…ç½®</button>
            <button class="action-btn danger" data-delete-api="${escapeHtml(item.id || "")}"><span style="font-size: 14px;">ðŸ—‘</span> åˆ é™¤æŽ¥å£</button>
          </div>
        `;
        div.querySelectorAll("button[data-copy]").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const value = btn.getAttribute("data-copy") || "";
            try {
              await navigator.clipboard.writeText(value);
              setStatus("å·²å¤åˆ¶");
              showToast("å¤åˆ¶æˆåŠŸ", "copy");
            } catch (err) {
              setStatus("å¤åˆ¶å¤±è´¥");
              showToast("å¤åˆ¶å¤±è´¥", "error");
            }
          });
        });
        div.querySelectorAll("button[data-use]").forEach((btn) => {
          const mode = btn.getAttribute("data-use");
          btn.addEventListener("click", () => useMockItem(item, mode === "error"));
        });
        const jsonBtn = div.querySelector("button[data-json]");
        if (jsonBtn) {
          jsonBtn.addEventListener("click", () => {
            if (!jsonModal) return;
            jsonReq.textContent = JSON.stringify(item.requestExample || {}, null, 2);
            jsonResp.textContent = JSON.stringify(item.responseExample || {}, null, 2);
            jsonErr.textContent = JSON.stringify(item.errorResponseExample || {}, null, 2);
            jsonModal.classList.add("open");
          });
        }
        const editBtn = div.querySelector("button[data-edit]");
        if (editBtn) {
          editBtn.addEventListener("click", () => {
            if (!editModal) return;
            editingMockId = item.id || null;
            editReq.value = JSON.stringify(item.requestExample || {}, null, 2);
            editResp.value = JSON.stringify(item.responseExample || {}, null, 2);
            editErr.value = JSON.stringify(item.errorResponseExample || {}, null, 2);
            editModal.classList.add("open");
          });
        }
        const delBtn = div.querySelector("button[data-delete-api]");
        if (delBtn) {
          delBtn.addEventListener("click", async () => {
            const id = delBtn.getAttribute("data-delete-api");
            if (!id) return;
            const ok = await openConfirmModal({
              title: "ç¡®è®¤åˆ é™¤",
              message: "ç¡®å®šåˆ é™¤è¯¥ Mock æŽ¥å£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚",
              okText: "ç¡®è®¤åˆ é™¤",
              danger: true
            });
            if (!ok) return;
            try {
              delBtn.disabled = true;
              const res = await fetch(`/parse/endpoint/${id}`, { method: "DELETE" });
              if (res.ok) {
                setStatus("å·²åˆ é™¤æŽ¥å£");
                showToast("åˆ é™¤æˆåŠŸ", "success");
                await loadHistory();
              } else {
                setStatus("åˆ é™¤å¤±è´¥");
                showToast("åˆ é™¤å¤±è´¥", "error");
              }
            } catch (err) {
              setStatus("åˆ é™¤å¼‚å¸¸");
              showToast("åˆ é™¤å¼‚å¸¸", "error");
            } finally {
              delBtn.disabled = false;
            }
          });
        }
        return div;
      }

      if (jsonModal) {
        jsonModal.addEventListener("click", (e) => {
          if (e.target === jsonModal) {
            jsonModal.classList.remove("open");
          }
        });
      }
      if (editModal) {
        editModal.addEventListener("click", (e) => {
          if (e.target === editModal) {
            editModal.classList.remove("open");
          }
        });
      }

      if (saveEditBtn) {
        saveEditBtn.addEventListener("click", async () => {
          if (!editingMockId) return;
          let reqJson;
          let respJson;
          let errJson;
          try {
            reqJson = editReq.value.trim() ? JSON.parse(editReq.value) : {};
            respJson = editResp.value.trim() ? JSON.parse(editResp.value) : {};
            errJson = editErr.value.trim() ? JSON.parse(editErr.value) : {};
          } catch (err) {
            setStatus("JSON æ ¼å¼é”™è¯¯");
            return;
          }
          try {
            const res = await fetch(`/parse/endpoint/${editingMockId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                requestExample: reqJson,
                responseExample: respJson,
                errorResponseExample: errJson
              })
            });
            if (res.ok) {
              setStatus("å·²ä¿å­˜");
              showToast("ä¿®æ”¹æˆåŠŸ", "success");
              editModal.classList.remove("open");
              await loadHistory();
            } else {
              setStatus("ä¿å­˜å¤±è´¥");
              showToast("ä¿å­˜å¤±è´¥", "error");
            }
          } catch (err) {
            setStatus("ä¿å­˜å¼‚å¸¸");
            showToast("ä¿å­˜å¼‚å¸¸", "error");
          }
        });
      }

      if (sceneSaveBtn) {
        sceneSaveBtn.addEventListener("click", async () => {
          const name = sceneNameInput ? sceneNameInput.value.trim() : "";
          const description = sceneDescInput ? sceneDescInput.value.trim() : "";
          const keywords = sceneKeywordsInput ? sceneKeywordsInput.value.trim() : "";
          if (!name) {
            setStatus("è¯·è¾“å…¥åœºæ™¯åç§°");
            showToast("åœºæ™¯åç§°ä¸èƒ½ä¸ºç©º", "error");
            return;
          }
          try {
            sceneSaveBtn.disabled = true;
            const payload = JSON.stringify({ name, description, keywords });
            const url = editingSceneId ? `/parse/scenes/${editingSceneId}` : "/parse/scenes";
            const method = editingSceneId ? "PUT" : "POST";
            const res = await fetch(url, {
              method,
              headers: { "Content-Type": "application/json" },
              body: payload
            });
            if (res.ok) {
              setStatus(editingSceneId ? "åœºæ™¯å·²æ›´æ–°" : "åœºæ™¯å·²åˆ›å»º");
              showToast(editingSceneId ? "æ›´æ–°æˆåŠŸ" : "åˆ›å»ºæˆåŠŸ", "success");
              setSceneForm(null);
              await loadScenes(true);
              await loadHistory();
            } else {
              setStatus("æ“ä½œå¤±è´¥");
              showToast("æ“ä½œå¤±è´¥", "error");
            }
          } catch (err) {
            setStatus("æ“ä½œå¼‚å¸¸");
            showToast("æ“ä½œå¼‚å¸¸", "error");
          } finally {
            sceneSaveBtn.disabled = false;
          }
        });
      }

      if (sceneCancelBtn) {
        sceneCancelBtn.addEventListener("click", () => setSceneForm(null));
      }

      if (manualCreateBtn) {
        manualCreateBtn.addEventListener("click", () => {
          if (!manualModal) return;
          setManualInputMode("manual");
          if (manualTitleInput) manualTitleInput.value = "";
          if (manualMethodSelect) manualMethodSelect.value = "POST";
          if (manualSceneSelect) manualSceneSelect.value = "";
          setManualMode("table");
          renderKeyValueTable(manualReqHeadersTable, {});
          renderKeyValueTable(manualReqQueryTable, {});
          renderKeyValueTable(manualReqBodyTable, {});
          renderKeyValueTable(manualRespHeadersTable, {});
          renderKeyValueTable(manualRespBodyTable, {});
          renderKeyValueTable(manualErrBodyTable, {});
          if (manualErrStatusInput) manualErrStatusInput.value = "";
          if (manualReqJson) manualReqJson.value = JSON.stringify({ headers: {}, query: {}, body: {} }, null, 2);
          if (manualRespJson) manualRespJson.value = JSON.stringify({ headers: {}, body: {} }, null, 2);
          if (manualErrJson) manualErrJson.value = "{}";
          if (manualRequired) manualRequired.value = "[]";
          manualChatMessages = [];
          renderChatHistory();
          manualModal.classList.add("open");
          // ç¡®ä¿ä¿å­˜æŒ‰é’®å¯è§ï¼šæ»šåŠ¨åˆ°åº•éƒ¨
          setTimeout(() => {
            const modalContent = document.querySelector("#manualModal .content");
            if (modalContent) {
              modalContent.scrollTop = modalContent.scrollHeight;
            }
          }, 100);
        });
      }

      if (manualSaveBtn) {
        manualSaveBtn.addEventListener("click", async () => {
          const title = manualTitleInput ? manualTitleInput.value.trim() : "";
          const method = manualMethodSelect ? manualMethodSelect.value : "POST";
          const sceneId = manualSceneSelect ? manualSceneSelect.value.trim() : "";
          if (!title) {
            setStatus("è¯·è¾“å…¥æŽ¥å£æ ‡é¢˜");
            showToast("æŽ¥å£æ ‡é¢˜ä¸èƒ½ä¸ºç©º", "error");
            return;
          }
          if (!sceneId) {
            setStatus("è¯·é€‰æ‹©åœºæ™¯");
            showToast("è¯·é€‰æ‹©åœºæ™¯", "error");
            return;
          }
          let reqObj;
          let respObj;
          let errObj;
          let requiredArr;
          try {
            if (manualJsonWrap && !manualJsonWrap.classList.contains("hidden")) {
              reqObj = manualReqJson && manualReqJson.value.trim() ? JSON.parse(manualReqJson.value) : {};
              respObj = manualRespJson && manualRespJson.value.trim() ? JSON.parse(manualRespJson.value) : {};
              errObj = manualErrJson && manualErrJson.value.trim() ? JSON.parse(manualErrJson.value) : {};
            } else {
              reqObj = {
                headers: collectTableData(manualReqHeadersTable),
                query: collectTableData(manualReqQueryTable),
                body: collectTableData(manualReqBodyTable)
              };
              respObj = {
                headers: collectTableData(manualRespHeadersTable),
                body: collectTableData(manualRespBodyTable)
              };
              errObj = collectTableData(manualErrBodyTable);
            }
            requiredArr = manualRequired && manualRequired.value.trim() ? JSON.parse(manualRequired.value) : [];
          } catch (err) {
            setStatus("JSON æ ¼å¼é”™è¯¯");
            showToast("JSON æ ¼å¼é”™è¯¯", "error");
            return;
          }
          const errorHttpStatus = manualErrStatusInput && manualErrStatusInput.value.trim()
            ? Number(manualErrStatusInput.value.trim())
            : null;
          try {
            manualSaveBtn.disabled = true;
            const res = await fetch("/parse/endpoint/manual", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                title,
                method,
                sceneId,
                requestExample: reqObj,
                responseExample: respObj,
                errorResponseExample: errObj,
                requiredFields: requiredArr,
                errorHttpStatus: errorHttpStatus
              })
            });
            if (res.ok) {
              const savedItem = await res.json();
              setStatus("å·²ä¿å­˜æŽ¥å£");
              showToast("åˆ›å»ºæˆåŠŸ", "success");
              manualModal.classList.remove("open");
              
              // å¦‚æžœå½“å‰æœ‰åœºæ™¯è¿‡æ»¤ï¼Œä¸”æ–°æŽ¥å£çš„åœºæ™¯ä¸Žå½“å‰è¿‡æ»¤ä¸ä¸€è‡´ï¼Œæ¸…é™¤è¿‡æ»¤ä»¥ç¡®ä¿æ–°æŽ¥å£æ˜¾ç¤º
              if (apiSceneFilter && apiSceneFilter.value) {
                const savedSceneId = savedItem.sceneId || "";
                const currentFilterSceneId = apiSceneFilter.value.trim();
                if (savedSceneId !== currentFilterSceneId) {
                  // æ¸…é™¤åœºæ™¯è¿‡æ»¤ï¼Œæ˜¾ç¤ºæ‰€æœ‰æŽ¥å£
                  apiSceneFilter.value = "";
                  showToast("å·²æ¸…é™¤åœºæ™¯è¿‡æ»¤ä»¥æ˜¾ç¤ºæ–°æŽ¥å£", "info");
                }
              }
              
              // ç¡®ä¿åˆ—è¡¨åˆ·æ–°
              await loadHistory();
            } else {
              const errorText = await res.text();
              setStatus("ä¿å­˜å¤±è´¥");
              showToast("ä¿å­˜å¤±è´¥: " + errorText, "error");
            }
          } catch (err) {
            setStatus("ä¿å­˜å¼‚å¸¸");
            showToast("ä¿å­˜å¼‚å¸¸", "error");
          } finally {
            manualSaveBtn.disabled = false;
          }
        });
      }

      function setManualMode(mode) {
        if (!manualTableWrap || !manualJsonWrap || !manualModeTable || !manualModeJson) return;
        const useJson = mode === "json";
        manualTableWrap.classList.toggle("hidden", useJson);
        manualJsonWrap.classList.toggle("hidden", !useJson);
        manualModeTable.classList.toggle("active", !useJson);
        manualModeJson.classList.toggle("active", useJson);
      }

      function setManualInputMode(mode) {
        const isChat = mode === "chat";
        if (manualChatWrap) manualChatWrap.classList.toggle("hidden", !isChat);
        if (manualModeManual) manualModeManual.classList.toggle("active", !isChat);
        if (manualModeChat) manualModeChat.classList.toggle("active", isChat);
        // åˆ‡æ¢æ¨¡å¼åŽï¼Œç¡®ä¿ä¿å­˜æŒ‰é’®å¯è§
        setTimeout(() => {
          const modalContent = document.querySelector("#manualModal .content");
          if (modalContent) {
            modalContent.scrollTop = modalContent.scrollHeight;
          }
        }, 100);
      }

      function syncTableToJson() {
        if (!manualReqJson || !manualRespJson || !manualErrJson) return;
        const reqObj = {
          headers: collectTableData(manualReqHeadersTable),
          query: collectTableData(manualReqQueryTable),
          body: collectTableData(manualReqBodyTable)
        };
        const respObj = {
          headers: collectTableData(manualRespHeadersTable),
          body: collectTableData(manualRespBodyTable)
        };
        const errObj = collectTableData(manualErrBodyTable);
        manualReqJson.value = JSON.stringify(reqObj, null, 2);
        manualRespJson.value = JSON.stringify(respObj, null, 2);
        manualErrJson.value = JSON.stringify(errObj, null, 2);
      }

      function syncJsonToTable() {
        try {
          const reqObj = manualReqJson && manualReqJson.value.trim() ? JSON.parse(manualReqJson.value) : {};
          const respObj = manualRespJson && manualRespJson.value.trim() ? JSON.parse(manualRespJson.value) : {};
          const errObj = manualErrJson && manualErrJson.value.trim() ? JSON.parse(manualErrJson.value) : {};
          renderKeyValueTable(manualReqHeadersTable, reqObj.headers || {});
          renderKeyValueTable(manualReqQueryTable, reqObj.query || {});
          renderKeyValueTable(manualReqBodyTable, reqObj.body || {});
          renderKeyValueTable(manualRespHeadersTable, respObj.headers || {});
          renderKeyValueTable(manualRespBodyTable, respObj.body || {});
          renderKeyValueTable(manualErrBodyTable, errObj || {});
          return true;
        } catch (err) {
          setStatus("JSON æ ¼å¼é”™è¯¯");
          showToast("JSON æ ¼å¼é”™è¯¯", "error");
          return false;
        }
      }

      if (manualModeTable) {
        manualModeTable.addEventListener("click", () => {
          if (manualJsonWrap && !manualJsonWrap.classList.contains("hidden")) {
            const ok = syncJsonToTable();
            if (!ok) return;
          }
          setManualMode("table");
        });
      }
      if (manualModeJson) {
        manualModeJson.addEventListener("click", () => {
          syncTableToJson();
          setManualMode("json");
        });
      }

      if (manualModeManual) {
        manualModeManual.addEventListener("click", () => setManualInputMode("manual"));
      }
      if (manualModeChat) {
        manualModeChat.addEventListener("click", () => setManualInputMode("chat"));
      }

      const manualChatImageInput = document.getElementById("manualChatImageInput");
      const manualChatImages = document.getElementById("manualChatImages");
      let currentChatImages = [];

      // å¤„ç†å›¾ç‰‡æ–‡ä»¶ï¼ˆä¸Šä¼ æˆ–ç²˜è´´ï¼‰
      function handleImageFile(file) {
        if (!file || !file.type.startsWith("image/")) {
          showToast("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶", "error");
          return false;
        }
        if (file.size > 10 * 1024 * 1024) {
          showToast("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MB", "error");
          return false;
        }
        const reader = new FileReader();
        reader.onload = (event) => {
          const base64 = event.target.result;
          const imageId = "img_" + Date.now();
          currentChatImages.push({ id: imageId, base64: base64, file: file });
          renderChatImages();
          showToast("å›¾ç‰‡å·²æ·»åŠ ", "success");
        };
        reader.readAsDataURL(file);
        return true;
      }

      // ä¸Šä¼ å›¾ç‰‡
      if (manualChatImageInput) {
        manualChatImageInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file) {
            handleImageFile(file);
            manualChatImageInput.value = "";
          }
        });
      }

      // ç²˜è´´å›¾ç‰‡æ”¯æŒ
      if (manualChatInput) {
        manualChatInput.addEventListener("paste", (e) => {
          const clipboardData = e.clipboardData || window.clipboardData;
          if (!clipboardData) return;
          
          const items = clipboardData.items;
          if (!items) return;
          
          for (let i = 0; i < items.length; i++) {
            const item = items[i];
            if (item.type.indexOf("image") !== -1) {
              e.preventDefault();
              const file = item.getAsFile();
              if (file) {
                handleImageFile(file);
              }
              break;
            }
          }
        });
      }

      function renderChatImages() {
        if (!manualChatImages) return;
        if (currentChatImages.length === 0) {
          manualChatImages.innerHTML = "";
          return;
        }
        manualChatImages.innerHTML = currentChatImages.map((img, idx) => `
          <div style="position: relative; border: 1px solid #ddd; border-radius: 4px; padding: 4px; background: #f9f9f9;">
            <img src="${img.base64}" style="max-width: 120px; max-height: 120px; display: block; border-radius: 4px;" />
            <button onclick="removeChatImage(${idx})" style="position: absolute; top: 2px; right: 2px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px;">Ã—</button>
          </div>
        `).join("");
      }

      window.removeChatImage = function(idx) {
        currentChatImages.splice(idx, 1);
        renderChatImages();
      };

      if (manualChatGenerateBtn) {
        manualChatGenerateBtn.addEventListener("click", async () => {
          const text = manualChatInput ? manualChatInput.value.trim() : "";
          if (!text && currentChatImages.length === 0) {
            setStatus("è¯·è¾“å…¥æè¿°æˆ–ä¸Šä¼ å›¾ç‰‡");
            showToast("è¯·è¾“å…¥æè¿°æˆ–ä¸Šä¼ å›¾ç‰‡", "error");
            return;
          }
          let originalText = "ç”Ÿæˆé¢„è§ˆ";
          try {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            originalText = manualChatGenerateBtn.textContent || "ç”Ÿæˆé¢„è§ˆ";
            manualChatGenerateBtn.disabled = true;
            manualChatGenerateBtn.innerHTML = '<span style="display:inline-block;width:14px;height:14px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:6px;"></span>ç”Ÿæˆä¸­...';
            
            // æž„å»ºæ¶ˆæ¯å†…å®¹ï¼ˆæ–‡æœ¬+å›¾ç‰‡ï¼‰
            const messageContent = [];
            if (text) {
              messageContent.push({ type: "text", text: text });
            }
            // æ·»åŠ å›¾ç‰‡
            for (const img of currentChatImages) {
              messageContent.push({ 
                type: "image_url", 
                image_url: { url: img.base64 }
              });
            }
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            manualChatMessages.push({ 
              role: "user", 
              content: messageContent.length === 1 && messageContent[0].type === "text" 
                ? messageContent[0].text 
                : messageContent
            });
            renderChatHistory();
            if (manualChatInput) manualChatInput.value = "";
            // æ¸…ç©ºå½“å‰å›¾ç‰‡ï¼ˆå·²æ·»åŠ åˆ°æ¶ˆæ¯åŽ†å²ï¼‰
            currentChatImages = [];
            renderChatImages();
            // æž„å»ºæ¶ˆæ¯æ•°ç»„å‘é€ç»™åŽç«¯
            const messages = manualChatMessages.map(msg => ({
              role: msg.role,
              content: msg.content
            }));
            const res = await fetch("/parse/endpoint/llm-preview", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ messages: messages })
            });
            if (!res.ok) {
              const errorText = await res.text();
              setStatus("ç”Ÿæˆå¤±è´¥");
              showToast("ç”Ÿæˆå¤±è´¥: " + errorText, "error");
              return;
            }
            const preview = await res.json();
            // æ·»åŠ  AI å“åº”åˆ°å¯¹è¯åŽ†å²
            manualChatMessages.push({ 
              role: "assistant", 
              content: "å·²ç”ŸæˆæŽ¥å£ç»“æž„ï¼š" + (preview.title || "æœªå‘½åæŽ¥å£")
            });
            renderChatHistory();
            // å¡«å……è¡¨å•
            if (manualTitleInput && preview.title) manualTitleInput.value = preview.title;
            if (manualMethodSelect && preview.method) manualMethodSelect.value = preview.method;
            if (manualErrStatusInput && preview.errorHttpStatus) manualErrStatusInput.value = String(preview.errorHttpStatus);
            if (manualRequired) manualRequired.value = JSON.stringify(preview.requiredFields || [], null, 2);
            const req = preview.requestExample || {};
            const resp = preview.responseExample || {};
            const err = preview.errorResponseExample || {};
            renderKeyValueTable(manualReqHeadersTable, req.headers || {});
            renderKeyValueTable(manualReqQueryTable, req.query || {});
            renderKeyValueTable(manualReqBodyTable, req.body || {});
            renderKeyValueTable(manualRespHeadersTable, resp.headers || {});
            renderKeyValueTable(manualRespBodyTable, resp.body || {});
            renderKeyValueTable(manualErrBodyTable, err || {});
            syncTableToJson();
            setManualMode("table");
            setStatus("å·²ç”Ÿæˆé¢„è§ˆ");
            showToast("ç”ŸæˆæˆåŠŸ", "success");
            // ç¡®ä¿ä¿å­˜æŒ‰é’®å¯è§ï¼šæ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
              const modalContent = document.querySelector("#manualModal .content");
              if (modalContent) {
                modalContent.scrollTop = modalContent.scrollHeight;
              }
            }, 100);
          } catch (err) {
            setStatus("ç”Ÿæˆå¼‚å¸¸");
            showToast("ç”Ÿæˆå¼‚å¸¸: " + (err.message || String(err)), "error");
          } finally {
            manualChatGenerateBtn.disabled = false;
            manualChatGenerateBtn.textContent = originalText;
          }
        });
      }

      if (manualChatClearBtn) {
        manualChatClearBtn.addEventListener("click", () => {
          manualChatMessages = [];
          currentChatImages = [];
          renderChatHistory();
          renderChatImages();
        });
      }

      let manualChatMessages = [];
      function renderChatHistory() {
        if (!manualChatHistory) return;
        if (!manualChatMessages.length) {
          manualChatHistory.innerHTML = "<div class='hint'>å¯å¤šè½®è¿½åŠ æè¿°ï¼Œç”Ÿæˆæ—¶ä¼šåˆå¹¶ä¸Šä¸‹æ–‡ã€‚æ”¯æŒä¸Šä¼ æˆªå›¾è¯†åˆ«æŽ¥å£ä¿¡æ¯ã€‚</div>";
          return;
        }
        manualChatHistory.innerHTML = manualChatMessages
          .map((msg, idx) => {
            const isUser = msg.role === "user";
            const roleLabel = isUser ? "ç”¨æˆ·" : "AI";
            const roleClass = isUser ? "user-msg" : "ai-msg";
            let contentHtml = "";
            if (isUser && Array.isArray(msg.content)) {
              // å¤šæ¨¡æ€æ¶ˆæ¯ï¼ˆæ–‡æœ¬+å›¾ç‰‡ï¼‰
              contentHtml = msg.content.map(item => {
                if (item.type === "text") {
                  return `<div style="margin-bottom:4px;">${escapeHtml(item.text)}</div>`;
                } else if (item.type === "image_url") {
                  return `<img src="${escapeHtml(item.image_url.url)}" style="max-width:200px; max-height:150px; border-radius:4px; margin:4px 0;" />`;
                }
                return "";
              }).join("");
            } else {
              contentHtml = escapeHtml(typeof msg.content === "string" ? msg.content : JSON.stringify(msg.content));
            }
            return `<div class="${roleClass}" style="margin-bottom:8px; padding:6px; border-radius:4px; background:${isUser ? '#e3f2fd' : '#f1f8e9'};">
              <div style="font-size:12px; color:#666; margin-bottom:4px;"><strong>${roleLabel}</strong> #${idx + 1}</div>
              <div style="font-size:13px; line-height:1.5;">${contentHtml}</div>
            </div>`;
          })
          .join("");
        // æ»šåŠ¨åˆ°åº•éƒ¨
        manualChatHistory.scrollTop = manualChatHistory.scrollHeight;
      }

      if (manualAddReqHeader) {
        manualAddReqHeader.addEventListener("click", () => addKeyValueRow(manualReqHeadersTable, "", ""));
      }
      if (manualAddReqQuery) {
        manualAddReqQuery.addEventListener("click", () => addKeyValueRow(manualReqQueryTable, "", ""));
      }
      if (manualAddReqBody) {
        manualAddReqBody.addEventListener("click", () => addKeyValueRow(manualReqBodyTable, "", ""));
      }
      if (manualAddRespHeader) {
        manualAddRespHeader.addEventListener("click", () => addKeyValueRow(manualRespHeadersTable, "", ""));
      }
      if (manualAddRespBody) {
        manualAddRespBody.addEventListener("click", () => addKeyValueRow(manualRespBodyTable, "", ""));
      }
      if (manualAddErrBody) {
        manualAddErrBody.addEventListener("click", () => addKeyValueRow(manualErrBodyTable, "", ""));
      }

      function toAbsoluteUrl(path) {
        if (!path) return "";
        if (path.startsWith("http://") || path.startsWith("https://")) {
          return path;
        }
        const base = window.location.origin || "http://localhost:8080";
        return base.replace(/\/$/, "") + "/" + path.replace(/^\//, "");
      }

      function escapeHtml(text) {
        return String(text || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      // Display-only formatter for required fields.
      // Rule: split by "_" / "-" / whitespace, capitalize each segment's first letter, join with spaces.
      // Examples: "user_id" -> "User Id", "user-name" -> "User Name", "userId" -> "UserId" (camelCase not split)
      function formatRequiredFieldLabel(field) {
        const raw = String(field == null ? "" : field).trim();
        if (!raw) return "";
        const parts = raw.split(/[_\-\s]+/).filter(Boolean);
        if (!parts.length) return raw;
        return parts
          .map((p) => {
            const s = String(p);
            if (!s) return s;
            return s.charAt(0).toUpperCase() + s.slice(1);
          })
          .join(" ");
      }

      function useMockItem(item, errorMode = false) {
        const mockUrl = toAbsoluteUrl(item.mockUrl || "");
        mockUrlInput.value = mockUrl;
        const req = item.requestExample || {};
        const title = (item.title || "").toLowerCase();
        currentMethod = (item.method || "").toUpperCase() || (title.includes("get ") || title.startsWith("get") ? "GET" : "POST");
        setMethodToggleLock(true, currentMethod);
        if (debugMethodSelect) {
          debugMethodSelect.value = currentMethod;
        }
        const required = Array.isArray(item.requiredFields) ? item.requiredFields : [];
        if (req.headers || req.query || req.body) {
          const parts = normalizeRequestParts(required, {
            headers: req.headers || {},
            query: req.query || req.queryParams || {},
            body: req.body || {}
          }, currentMethod, req);
          renderKeyValueTable(headersTable, parts.headers || {});
          renderKeyValueTable(queryTable, parts.query || {});
          mockBody.value = JSON.stringify(parts.body || {}, null, 2);
        } else {
          const extracted = splitRequestByPath(req);
          const parts = normalizeRequestParts(required, extracted, currentMethod, req);
          renderKeyValueTable(headersTable, parts.headers || {});
          renderKeyValueTable(queryTable, parts.query || {});
          mockBody.value = JSON.stringify(parts.body || {}, null, 2);
        }
        if (!mockBody.value || mockBody.value === "{}") {
          const fallback = extractBodyFromRequest(req);
          mockBody.value = JSON.stringify(fallback, null, 2);
        }
        if (!mockBody.value) {
          renderKeyValueTable(headersTable, {});
          renderKeyValueTable(queryTable, {});
          mockBody.value = JSON.stringify(req || {}, null, 2);
        }
        if (currentMethod === "GET") {
          mockBody.value = "{}";
        }
        if (currentMethod === "POST") {
          renderKeyValueTable(queryTable, {});
        }
        renderRequiredChips(required);
        if (errorMode) {
          if (currentMethod === "GET") {
            setTableValue(queryTable, "__mock_error", "1");
          } else {
            try {
              const parsed = mockBody.value.trim() ? JSON.parse(mockBody.value) : {};
              parsed.__mock_error = true;
              mockBody.value = JSON.stringify(parsed, null, 2);
            } catch (err) {
              // ignore
            }
          }
          setTableValue(headersTable, "__mock_error", "1");
        }
        mockResponse.textContent = "{}";
        switchTab("debug");
      }

      async function sendMockRequest() {
        const url = mockUrlInput.value.trim();
        if (!url) {
          setStatus("è¯·è¾“å…¥Mockåœ°å€");
          return;
        }
        const setSendBtnUi = (state) => {
          if (!sendMockBtn) return;
          sendMockBtn.classList.remove("is-success", "is-error");
          if (state === "loading") {
            sendMockBtn.classList.add("btn-loading");
            sendMockBtn.innerHTML = `<span style="font-size: 16px;">â³</span> è¯·æ±‚ä¸­`;
            return;
          }
          if (state === "success") {
            sendMockBtn.classList.add("is-success");
            sendMockBtn.innerHTML = `<span style="font-size: 16px;">âœ“</span> è¯·æ±‚å®Œæˆ`;
            return;
          }
          if (state === "error") {
            sendMockBtn.classList.add("is-error");
            sendMockBtn.innerHTML = `<span style="font-size: 16px;">!</span> è¯·æ±‚å¤±è´¥`;
            return;
          }
          sendMockBtn.classList.remove("btn-loading");
          sendMockBtn.innerHTML = `<span style="font-size: 16px;">â–¶</span> å‘é€è¯·æ±‚`;
        };

        setSendBtnUi("loading");
        if (debugMethodSelect) {
          currentMethod = debugMethodSelect.value || currentMethod;
        }
        let body = {};
        let headers = {};
        let query = {};
        try {
          body = mockBody.value.trim() ? JSON.parse(mockBody.value) : {};
          headers = collectTableData(headersTable);
          query = collectTableData(queryTable);
        } catch (err) {
          setStatus("è¯·æ±‚JSONæ ¼å¼é”™è¯¯");
          setSendBtnUi("error");
          setTimeout(() => setSendBtnUi("idle"), 900);
          return;
        }
        const hasHeader = (obj, name) => {
          const target = String(name || "").toLowerCase();
          return Object.keys(obj || {}).some((k) => k.toLowerCase() === target);
        };
        if (!hasHeader(headers, "Content-Type")) {
          headers["Content-Type"] = "application/json";
        }
        if (!hasHeader(headers, "Accept")) {
          headers["Accept"] = "application/json";
        }
        if (currentMethod === "GET") {
          body = {};
        }
        if (currentMethod === "POST") {
          query = {};
        }
        if ((!mockBody.value || mockBody.value.trim() === "" || mockBody.value.trim() === "{}") && Object.keys(body).length === 0) {
          const req = mockBody.value.trim() ? JSON.parse(mockBody.value) : {};
          body = extractBodyFromRequest(req);
        }
        setStatus("ðŸš€ è°ƒç”¨AIç”ŸæˆåŠ¨æ€å“åº”ä¸­...");
        if (aiLoadingOverlay) {
          aiLoadingOverlay.classList.add("show");
          // Animate horse running with better frames
          const horseEl = aiLoadingOverlay.querySelector(".ai-horse");
          const horseFrames = ["ðŸ´", "ðŸŽ", "ðŸ‡", "ðŸŽ"];
          let frameIndex = 0;
          const horseAnimInterval = setInterval(() => {
            if (horseEl) {
              frameIndex = (frameIndex + 1) % horseFrames.length;
              horseEl.textContent = horseFrames[frameIndex];
            }
          }, 120);
          aiLoadingOverlay.dataset.animInterval = horseAnimInterval;
        }
        mockResponse.textContent = "";
        if (debugStatus) debugStatus.textContent = "Status: -";
        if (debugTime) debugTime.textContent = "Time: -";
        if (debugSize) debugSize.textContent = "Size: ...";
        try {
          const start = performance.now();
          const fullUrl = buildUrlWithQuery(url, query);
          if (debugStatus) debugStatus.textContent = "Status: è¯·æ±‚ä¸­";
          const res = await fetch(fullUrl, {
            method: currentMethod,
            headers: headers,
            body: currentMethod === "POST" ? JSON.stringify(body) : undefined
          });
          const text = await res.text();
          const elapsed = Math.round(performance.now() - start);
          if (aiLoadingOverlay) {
            aiLoadingOverlay.classList.remove("show");
            if (aiLoadingOverlay.dataset.animInterval) {
              clearInterval(parseInt(aiLoadingOverlay.dataset.animInterval));
              delete aiLoadingOverlay.dataset.animInterval;
            }
          }
          try {
            const json = JSON.parse(text);
            mockResponse.textContent = JSON.stringify(json, null, 2);
          } catch (err) {
            mockResponse.textContent = text;
          }
          if (!res.ok) {
            setStatus("âŒ è¯·æ±‚å¤±è´¥ï¼š" + res.status);
            setSendBtnUi("error");
          } else {
            const cacheHint = elapsed < 500 ? " (ç¼“å­˜å‘½ä¸­)" : " (AIç”Ÿæˆ)";
            setStatus("âœ… å®Œæˆ" + cacheHint);
            setSendBtnUi("success");
          }
          if (debugStatus) debugStatus.textContent = `Status: ${res.status}`;
          if (debugTime) {
            const timeColor = elapsed < 500 ? "#22c55e" : (elapsed < 2000 ? "#f59e0b" : "#ef4444");
            debugTime.innerHTML = `Time: <span style="color: ${timeColor}; font-weight: 600;">${elapsed}ms</span>`;
          }
          if (debugSize) debugSize.textContent = `Size: ${text.length} bytes`;
          if (debugCurl) debugCurl.textContent = buildCurl(fullUrl, headers, body, currentMethod);
          if (responseHeadersTable) {
            renderKeyValueTableReadonly(responseHeadersTable, res.headers);
          }
        } catch (err) {
          if (aiLoadingOverlay) {
            aiLoadingOverlay.classList.remove("show");
            if (aiLoadingOverlay.dataset.animInterval) {
              clearInterval(parseInt(aiLoadingOverlay.dataset.animInterval));
              delete aiLoadingOverlay.dataset.animInterval;
            }
          }
          setStatus("âŒ è¯·æ±‚å¼‚å¸¸ï¼š" + err.message);
          mockResponse.textContent = "// è¯·æ±‚å¤±è´¥\n" + err.message;
          if (debugStatus) debugStatus.textContent = "Status: å¼‚å¸¸";
          setSendBtnUi("error");
        } finally {
          if (sendMockBtn) sendMockBtn.classList.remove("btn-loading");
          // Keep success/error color briefly, then return to idle.
          setTimeout(() => setSendBtnUi("idle"), 900);
        }
      }

      if (debugMethodSelect) {
        debugMethodSelect.addEventListener("change", () => {
          currentMethod = debugMethodSelect.value;
          if (currentMethod === "GET") {
            mockBody.value = "{}";
          }
          if (currentMethod === "POST") {
            renderKeyValueTable(queryTable, {});
          }
        });
      }

      // Method segmented toggle (POST/GET): no dropdown, avoids overlay issues.
      if (methodToggle) {
        const pills = Array.from(methodToggle.querySelectorAll(".method-pill"));
        const setMethod = (method) => {
          if (!method) return;
          if (methodToggle.dataset.locked === "true") {
            return;
          }
          currentMethod = method;
          if (debugMethodSelect) {
            debugMethodSelect.value = method;
            // Reuse existing handler for side effects.
            debugMethodSelect.dispatchEvent(new Event("change"));
          } else {
            if (currentMethod === "GET") mockBody.value = "{}";
            if (currentMethod === "POST") renderKeyValueTable(queryTable, {});
          }
          pills.forEach((p) => p.classList.toggle("active", p.getAttribute("data-method") === method));
        };
        pills.forEach((p) => {
          p.addEventListener("click", () => setMethod(p.getAttribute("data-method")));
        });
        // Init from select value (or default POST)
        setMethod((debugMethodSelect && debugMethodSelect.value) || "POST");
      }

      function setMethodToggleLock(locked, allowedMethod) {
        if (!methodToggle) return;
        methodToggle.dataset.locked = locked ? "true" : "false";
        const pills = Array.from(methodToggle.querySelectorAll(".method-pill"));
        pills.forEach((p) => {
          const method = p.getAttribute("data-method");
          const disabled = locked && method !== allowedMethod;
          p.disabled = disabled;
          p.style.opacity = disabled ? "0.5" : "";
          p.style.cursor = disabled ? "not-allowed" : "";
        });
      }

      function buildUrlWithQuery(url, query) {
        if (!query || Object.keys(query).length === 0) {
          return url;
        }
        const params = new URLSearchParams();
        Object.keys(query).forEach((key) => {
          const value = query[key];
          if (value !== undefined && value !== null) {
            params.append(key, String(value));
          }
        });
        const joiner = url.includes("?") ? "&" : "?";
        return url + joiner + params.toString();
      }

      function buildCurl(url, headers, body, method) {
        const lines = [`curl -X ${method} "${url}"`];
        Object.keys(headers || {}).forEach((key) => {
          lines.push(`-H "${key}: ${headers[key]}"`);
        });
        if (method === "POST" && body && Object.keys(body).length) {
          lines.push(`-d '${JSON.stringify(body)}'`);
        }
        return lines.join(" \\\n  ");
      }

      function splitRequestByPath(requestExample) {
        const headers = {};
        const query = {};
        const body = {};
        if (!requestExample || typeof requestExample !== "object") {
          return { headers, query, body };
        }
        Object.keys(requestExample).forEach((key) => {
          if (key.startsWith("headers.")) {
            headers[key.replace("headers.", "")] = requestExample[key];
          } else if (key.startsWith("query.")) {
            query[key.replace("query.", "")] = requestExample[key];
          } else if (key.startsWith("body.")) {
            body[key.replace("body.", "")] = requestExample[key];
          }
        });
        return { headers, query, body };
      }

      function extractBodyFromRequest(requestExample) {
        if (!requestExample || typeof requestExample !== "object") {
          return {};
        }
        if (requestExample.body && typeof requestExample.body === "object") {
          return requestExample.body;
        }
        if (requestExample.request && typeof requestExample.request === "object") {
          return requestExample.request;
        }
        if (requestExample.data && typeof requestExample.data === "object") {
          return requestExample.data;
        }
        return requestExample;
      }

      document.querySelectorAll("[data-req-tab]").forEach((el) => {
        el.addEventListener("click", () => {
          document.querySelectorAll("[data-req-tab]").forEach((n) => n.classList.remove("active"));
          el.classList.add("active");
          const tab = el.getAttribute("data-req-tab");
          if (reqBodyPanel) reqBodyPanel.classList.toggle("active", tab === "body");
          if (reqHeadersPanel) reqHeadersPanel.classList.toggle("active", tab === "headers");
          if (reqQueryPanel) reqQueryPanel.classList.toggle("active", tab === "query");
        });
      });
      document.querySelectorAll("[data-resp-tab]").forEach((el) => {
        el.addEventListener("click", () => {
          document.querySelectorAll("[data-resp-tab]").forEach((n) => n.classList.remove("active"));
          el.classList.add("active");
          const tab = el.getAttribute("data-resp-tab");
          if (respBodyPanel) respBodyPanel.classList.toggle("active", tab === "body");
          if (respHeadersPanel) respHeadersPanel.classList.toggle("active", tab === "headers");
        });
      });

      function renderKeyValueTable(container, data) {
        if (!container) return;
        container.innerHTML = "";
        Object.keys(data || {}).forEach((key) => {
          addKeyValueRow(container, key, data[key]);
        });
        if (!container.children.length) {
          addKeyValueRow(container, "", "");
        }
      }

      function renderKeyValueTableReadonly(container, headers) {
        if (!container) return;
        container.innerHTML = "";
        if (!headers) return;
        if (typeof headers.forEach === "function") {
          headers.forEach((value, key) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${escapeHtml(key)}</td><td>${escapeHtml(value)}</td>`;
            container.appendChild(tr);
          });
        }
      }

      function setTableValue(container, key, value) {
        if (!container) return;
        let found = false;
        Array.from(container.querySelectorAll("tr")).forEach((tr) => {
          const inputs = tr.querySelectorAll("input");
          if (inputs.length >= 2 && inputs[0].value.trim() === key) {
            inputs[1].value = value;
            found = true;
          }
        });
        if (!found) {
          addKeyValueRow(container, key, value);
        }
      }

      function renderRequiredChips(required) {
        if (!ruleHint) return;
        ruleHint.innerHTML = "";
        if (!required || !required.length) {
          const span = document.createElement("span");
          span.className = "chip";
          span.textContent = "æ— å¿…å¡«å­—æ®µ";
          ruleHint.appendChild(span);
          return;
        }
        required.forEach((field) => {
          const span = document.createElement("span");
          span.className = "chip";
          span.textContent = formatRequiredFieldLabel(field);
          ruleHint.appendChild(span);
        });
      }

      function parseJsonLoose(text) {
        if (!text) return null;
        const trimmed = text.trim();
        try {
          return JSON.parse(trimmed);
        } catch (err) {
          // continue
        }
        if ((trimmed.startsWith("\"") && trimmed.endsWith("\"")) || (trimmed.startsWith("'") && trimmed.endsWith("'"))) {
          try {
            const unescaped = JSON.parse(trimmed);
            if (typeof unescaped === "string") {
              try {
                return JSON.parse(unescaped);
              } catch (err) {
                return null;
              }
            }
          } catch (err) {
            // ignore
          }
        }
        const firstObj = trimmed.indexOf("{");
        const firstArr = trimmed.indexOf("[");
        let start = -1;
        if (firstObj !== -1 && firstArr !== -1) {
          start = Math.min(firstObj, firstArr);
        } else {
          start = Math.max(firstObj, firstArr);
        }
        const lastObj = trimmed.lastIndexOf("}");
        const lastArr = trimmed.lastIndexOf("]");
        const end = Math.max(lastObj, lastArr);
        if (start !== -1 && end !== -1 && end > start) {
          const slice = trimmed.slice(start, end + 1);
          try {
            return JSON.parse(slice);
          } catch (err) {
            return null;
          }
        }
        return null;
      }

      function prettyPrintFallback(text) {
        if (!text) return "";
        const trimmed = text.trim();
        if (!trimmed) return "";
        let out = "";
        let indent = 0;
        let inString = false;
        let escape = false;
        const indentStr = (n) => "  ".repeat(n);
        for (let i = 0; i < trimmed.length; i++) {
          const ch = trimmed[i];
          if (escape) {
            out += ch;
            escape = false;
            continue;
          }
          if (ch === "\\") {
            out += ch;
            if (inString) escape = true;
            continue;
          }
          if (ch === "\"") {
            inString = !inString;
            out += ch;
            continue;
          }
          if (inString) {
            out += ch;
            continue;
          }
          if (ch === "{" || ch === "[") {
            out += ch + "\n" + indentStr(++indent);
            continue;
          }
          if (ch === "}" || ch === "]") {
            out += "\n" + indentStr(--indent) + ch;
            continue;
          }
          if (ch === ",") {
            out += ch + "\n" + indentStr(indent);
            continue;
          }
          if (ch === ":") {
            out += ": ";
            continue;
          }
          out += ch;
        }
        return out;
      }

      function normalizeRequestParts(requiredFields, parts, method, source) {
        const headers = { ...(parts.headers || {}) };
        const query = { ...(parts.query || {}) };
        const body = { ...(parts.body || {}) };
        const required = Array.isArray(requiredFields) ? requiredFields : [];
        required.forEach((path) => {
          if (!path) return;
          const lower = path.toLowerCase();
          const key = path.split(".").slice(1).join(".");
          const fallbackValue = findValueByKey(source || {}, key);
          if (lower.startsWith("headers.") || lower.startsWith("header.")) {
            if (headers[key] === undefined && body[key] !== undefined) {
              headers[key] = body[key];
            }
            if (headers[key] === undefined && fallbackValue !== undefined) {
              headers[key] = fallbackValue;
            }
          } else if (lower.startsWith("queryparams.") || lower.startsWith("query.")) {
            if (query[key] === undefined && body[key] !== undefined) {
              query[key] = body[key];
              delete body[key];
            }
            if (query[key] === undefined && fallbackValue !== undefined) {
              query[key] = fallbackValue;
            }
          } else if (lower.startsWith("body.")) {
            if (body[key] === undefined && query[key] !== undefined) {
              body[key] = query[key];
            }
            if (body[key] === undefined && fallbackValue !== undefined) {
              body[key] = fallbackValue;
            }
          }
        });
        if (method === "GET" && Object.keys(query).length === 0 && Object.keys(body).length > 0) {
          Object.keys(body).forEach((key) => {
            if (query[key] === undefined) {
              query[key] = body[key];
            }
          });
          Object.keys(body).forEach((key) => delete body[key]);
        }
        if (method === "POST" && Object.keys(body).length === 0 && Object.keys(query).length > 0) {
          Object.keys(query).forEach((key) => {
            if (body[key] === undefined) {
              body[key] = query[key];
            }
          });
          Object.keys(query).forEach((key) => delete query[key]);
        }
        if (method === "GET" && Object.keys(query).length === 0 && source && typeof source === "object") {
          Object.keys(source).forEach((key) => {
            if (query[key] === undefined && typeof source[key] !== "object") {
              query[key] = source[key];
            }
          });
        }
        if (method === "GET") {
          return { headers, query: query, body: {} };
        }
        if (method === "POST") {
          return { headers, query: {}, body: body };
        }
        return { headers, query, body };
      }

      function findValueByKey(obj, targetKey) {
        if (!obj || typeof obj !== "object" || !targetKey) return undefined;
        const lowerTarget = String(targetKey).toLowerCase();
        const stack = [obj];
        while (stack.length) {
          const current = stack.pop();
          if (!current || typeof current !== "object") continue;
          Object.keys(current).forEach((key) => {
            const value = current[key];
            if (String(key).toLowerCase() === lowerTarget && value !== undefined) {
              stack.length = 0;
              return value;
            }
            if (value && typeof value === "object") {
              stack.push(value);
            }
          });
        }
        return undefined;
      }

      function addKeyValueRow(container, key, value) {
        const tr = document.createElement("tr");
        let displayValue = "";
        if (value === null || value === undefined) {
          displayValue = "";
        } else if (typeof value === "object") {
          // å¯¹è±¡æˆ–æ•°ç»„ï¼Œæ ¼å¼åŒ–ä¸º JSON å­—ç¬¦ä¸²
          try {
            displayValue = JSON.stringify(value, null, 2);
          } catch (e) {
            displayValue = String(value);
          }
        } else {
          displayValue = String(value);
        }
        tr.innerHTML = `
          <td><input class="kv-input" value="${escapeHtml(key)}" /></td>
          <td><input class="kv-input" value="${escapeHtml(displayValue)}" /></td>
          <td><button class="action-btn">åˆ é™¤</button></td>
        `;
        tr.querySelector(".action-btn").addEventListener("click", () => tr.remove());
        container.appendChild(tr);
      }

      function collectTableData(container) {
        const result = {};
        if (!container) return result;
        Array.from(container.querySelectorAll("tr")).forEach((tr) => {
          const inputs = tr.querySelectorAll("input");
          if (inputs.length >= 2) {
            const key = inputs[0].value.trim();
            const value = inputs[1].value.trim();
            if (key) {
              result[key] = value;
            }
          }
        });
        return result;
      }

      if (addHeaderRow) {
        addHeaderRow.addEventListener("click", () => addKeyValueRow(headersTable, "", ""));
      }
      if (addQueryRow) {
        addQueryRow.addEventListener("click", () => addKeyValueRow(queryTable, "", ""));
      }
      if (copyCurlBtn) {
        copyCurlBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(debugCurl ? debugCurl.textContent : "");
            setStatus("å·²å¤åˆ¶ cURL");
            showToast("å¤åˆ¶æˆåŠŸ", "copy");
          } catch (err) {
            setStatus("å¤åˆ¶å¤±è´¥");
            showToast("å¤åˆ¶å¤±è´¥", "error");
          }
        });
      }

      function switchTab(tab) {
        document.querySelectorAll(".nav span").forEach((el) => {
          el.classList.toggle("active", el.getAttribute("data-tab") === tab);
        });
        // Highlight corresponding quick start card
        document.querySelectorAll(".quick").forEach((el) => {
          el.classList.toggle("active", el.getAttribute("data-jump") === tab);
        });
        document.getElementById("home").classList.toggle("hidden", tab !== "home");
        document.getElementById("doc").classList.toggle("hidden", tab !== "doc");
        document.getElementById("api").classList.toggle("hidden", tab !== "api");
        document.getElementById("scene").classList.toggle("hidden", tab !== "scene");
        document.getElementById("debug").classList.toggle("hidden", tab !== "debug");
        document.getElementById("logs").classList.toggle("hidden", tab !== "logs");
        if (tab === "logs") {
          loadLogs();
        }
      }

      document.querySelectorAll(".nav span").forEach((el) => {
        el.addEventListener("click", () => switchTab(el.getAttribute("data-tab")));
      });

      document.querySelectorAll("[data-jump]").forEach((el) => {
        el.addEventListener("click", () => switchTab(el.getAttribute("data-jump")));
      });

      if (apiSearch) {
        apiSearch.addEventListener("input", () => loadHistory());
      }
      if (apiSceneFilter) {
        apiSceneFilter.addEventListener("change", () => loadHistory());
      }

      async function loadLogs(fromUserAction = false) {
        if (!logTableBody) {
          return;
        }
        const setRefreshBtnUi = (state) => {
          if (!refreshLogsBtn) return;
          if (state === "loading") {
            refreshLogsBtn.classList.add("btn-loading");
            refreshLogsBtn.textContent = "â³ åˆ·æ–°ä¸­";
            return;
          }
          refreshLogsBtn.classList.remove("btn-loading");
          refreshLogsBtn.textContent = "åˆ·æ–°æ—¥å¿—";
        };
        if (fromUserAction) {
          setRefreshBtnUi("loading");
          setStatus("åŠ è½½æ—¥å¿—ä¸­...");
        }
        try {
          const [statsRes, listRes, todayRes, weekRes, sceneTodayRes, sceneWeekRes] = await Promise.all([
            fetch("/parse/logs/stats"),
            fetch("/parse/logs"),
            fetch("/parse/logs/stats/endpoint-today"),
            fetch("/parse/logs/stats/endpoint-week"),
            fetch("/parse/logs/stats/scene-today"),
            fetch("/parse/logs/stats/scene-week")
          ]);
          if (!statsRes.ok && !listRes.ok && !todayRes.ok && !weekRes.ok) {
            if (fromUserAction) {
              setStatus(`åŠ è½½å¤±è´¥ï¼š${listRes.status || statsRes.status}`);
            }
          }
          if (statsRes.ok) {
            const stats = await statsRes.json();
            const total = (stats.mockHit || 0) + (stats.mockGen || 0) + (stats.mockError || 0) + (stats.mockValidationFail || 0);
            statTotal.textContent = total;
            statUpload.textContent = stats.uploadMock || 0;
            statHit.textContent = stats.mockHit || 0;
            const delta = stats.mockGen24h ? Math.round((stats.mockGen24h / Math.max(1, total)) * 100) : 0;
            statDelta.textContent = `+${delta}% çŽ¯æ¯”`;
            renderTrend(logTrend, [
              stats.mockHit24h || 0,
              stats.mockGen24h || 0,
              stats.mockError24h || 0,
              stats.mockValidationFail24h || 0,
              stats.uploadMock || 0
            ]);
          }
          if (listRes.ok) {
            const list = await listRes.json();
            renderLogTable(list);
          } else if (fromUserAction) {
            logTableBody.innerHTML = `<tr><td colspan='6' class='hint'>æ—¥å¿—åŠ è½½å¤±è´¥ï¼ˆ${listRes.status}ï¼‰</td></tr>`;
          }
          if (todayRes.ok && endpointTodayStats) {
            const list = await todayRes.json();
            renderEndpointBars(endpointTodayStats, list);
          }
          if (weekRes.ok && endpointWeekStats) {
            const list = await weekRes.json();
            renderEndpointBars(endpointWeekStats, list);
          }
          if (sceneTodayRes.ok && sceneTodayStats) {
            const list = await sceneTodayRes.json();
            renderSceneBars(sceneTodayStats, list);
          }
          if (sceneWeekRes.ok && sceneWeekStats) {
            const list = await sceneWeekRes.json();
            renderSceneBars(sceneWeekStats, list);
          }
          if (fromUserAction) {
            setStatus("æ—¥å¿—å·²åˆ·æ–°");
          }
        } catch (err) {
          if (fromUserAction) {
            setStatus("æ—¥å¿—åˆ·æ–°å¼‚å¸¸ï¼š" + (err && err.message ? err.message : String(err)));
            logTableBody.innerHTML = `<tr><td colspan='6' class='hint'>æ—¥å¿—åˆ·æ–°å¼‚å¸¸</td></tr>`;
          }
        } finally {
          if (fromUserAction) {
            setRefreshBtnUi("idle");
          }
        }
      }

      function renderEndpointBars(container, list) {
        if (!container) return;
        if (!Array.isArray(list) || !list.length) {
          container.innerHTML = "<div class='hint'>æš‚æ— æ•°æ®</div>";
          return;
        }
        const sorted = list.slice().sort((a, b) => (b.count || 0) - (a.count || 0));
        const max = Math.max(1, ...sorted.map((x) => x.count || 0));
        container.innerHTML = sorted.map((row) => {
          const width = Math.round(((row.count || 0) / max) * 100);
          return `
            <div class="bar">
              <div>${escapeHtml(row.title || row.mockId || "-")}</div>
              <div class="track"><div class="fill" style="width:${width}%"></div></div>
              <div>${row.count || 0}</div>
            </div>
          `;
        }).join("");
      }

      function renderSceneBars(container, list) {
        if (!container) return;
        if (!Array.isArray(list) || !list.length) {
          container.innerHTML = "<div class='hint'>æš‚æ— æ•°æ®</div>";
          return;
        }
        const sorted = list.slice().sort((a, b) => (b.count || 0) - (a.count || 0));
        const max = Math.max(1, ...sorted.map((x) => x.count || 0));
        container.innerHTML = sorted.map((row) => {
          const width = Math.round(((row.count || 0) / max) * 100);
          return `
            <div class="bar">
              <div>${escapeHtml(row.sceneName || row.sceneId || "-")}</div>
              <div class="track"><div class="fill" style="width:${width}%"></div></div>
              <div>${row.count || 0}</div>
            </div>
          `;
        }).join("");
      }

      function renderTrend(container, values) {
        if (!container) return;
        const max = Math.max(1, ...values);
        container.innerHTML = values.map((v, idx) => {
          const h = Math.max(8, Math.round((v / max) * 100));
          const cls = idx === 2 ? "err" : idx === 1 ? "gen" : "hit";
          return `<div class="bar ${cls}" style="height:${h}%;"></div>`;
        }).join("");
      }

      function renderLogTable(list) {
        logTableBody.innerHTML = "";
        if (!Array.isArray(list) || !list.length) {
          logTableBody.innerHTML = "<tr><td colspan='6' class='hint'>æš‚æ— æ—¥å¿—</td></tr>";
          return;
        }
        const now = new Date();
        logUpdatedAt.textContent = `æœ€åŽæ›´æ–° ${now.toLocaleTimeString()}`;
        list.forEach((row) => {
          const type = row.type || "-";
          const badge = badgeClass(type);
          const dot = dotClass(type);
          const tr = document.createElement("tr");
          tr.className = "log-row";
          tr.innerHTML = `
            <td><span class="status-dot ${dot}"></span></td>
            <td><span class="badge ${badge}">${escapeHtml(type)}</span></td>
            <td>${escapeHtml(row.sourceFileName || "-")}</td>
            <td>${escapeHtml(row.message || "-")}</td>
            <td class="muted">${escapeHtml(row.createdAt || "-")}</td>
            <td style="text-align:right;">
              <button class="action-btn">æŸ¥çœ‹JSON</button>
            </td>
          `;
          tr.querySelector(".action-btn").addEventListener("click", () => {
            if (logModal) {
              logModalContent.textContent = JSON.stringify(row, null, 2);
              logModal.classList.add("open");
            }
          });
          logTableBody.appendChild(tr);
        });
      }

      function badgeClass(type) {
        if (type === "MOCK_GEN") return "gen";
        if (type === "MOCK_HIT") return "hit";
        if (type === "MOCK_ERROR") return "err";
        if (type === "MOCK_VALIDATION_FAIL") return "fail";
        if (type === "UPLOAD_MOCK") return "upload";
        return "upload";
      }

      function dotClass(type) {
        if (type === "MOCK_GEN") return "dot-green";
        if (type === "MOCK_HIT") return "dot-blue";
        if (type === "MOCK_ERROR") return "dot-red";
        if (type === "MOCK_VALIDATION_FAIL") return "dot-orange";
        return "dot-gray";
      }

      switchTab("home");
      loadHistory();
      loadScenes();
    </script>
  </body>
</html>
