# 接口文档解析与提示词模板

本文档提供一套完整的接口文档解析流程与可直接使用的提示词模板，适用于 Word/PDF 文档解析并生成结构化接口 JSON。

## 一、完整解析流程（Word/PDF → 接口 JSON）

### Step 0. 文档归一化

目标：把 Word/PDF 变成“带结构的文本”。

- Word → HTML / JSON（保留标题层级与表格）
- PDF → 文本 + 表格结构（优先结构化解析，扫描版才 OCR）
- 输出结构建议：
  - `sections[]`：包含 `title`, `level`, `content`, `tables[]`
  - 表格字段：`headers[]`, `rows[]`

### Step 1. 分块（Chunking）

按接口粒度分块。

- 以“接口名/路径/请求方法/功能描述”为锚点
- 将每个接口段落 + 表格放在一个 chunk

### Step 2. LLM 抽取结构

每个 chunk 交给大模型抽取结构。

- 让模型输出标准 JSON（见下方输出协议）

### Step 3. JSON 校验与修复

- 校验字段合法性（method/path/type/required）
- 短缺字段补空（例如 response 未描述 → 标记 `unknown`）
- 统一类型（string/int/float/bool/object/array）

### Step 4. 汇总

- 合并接口列表
- 输出统一 `api_list.json` 或 OpenAPI 结构

## 二、统一输出协议（建议 JSON 结构）

```json
{
  "title": "接口名",
  "path": "/api/user/list",
  "method": "GET",
  "description": "接口描述",
  "headers": [
    {"name": "token", "type": "string", "required": true, "desc": "鉴权"}
  ],
  "query": [
    {"name": "page", "type": "int", "required": true, "desc": "页码", "example": 1}
  ],
  "body": [
    {"name": "keyword", "type": "string", "required": false, "desc": "搜索关键词"}
  ],
  "response": {
    "type": "object",
    "fields": [
      {"name": "code", "type": "int", "desc": "状态码", "example": 0},
      {"name": "data", "type": "object", "fields": []}
    ]
  }
}
```

## 三、提示词模板（可直接用）

### A. 主抽取提示词（单接口）

```
你是接口文档解析助手。请从输入的“接口片段”中提取结构化JSON。
要求：
1. 必须输出严格JSON，不要包含多余文字。
2. 类型只允许：string/int/float/bool/object/array/unknown。
3. required 必须是 true/false。
4. 如果字段缺失，填 null 或 unknown。
5. 优先使用表格信息，其次使用文字描述。
6. 示例值如果文档给了就填 example，否则不填。

输出格式如下（不要增加字段）：
{
  "title": "",
  "path": "",
  "method": "",
  "description": "",
  "headers": [],
  "query": [],
  "body": [],
  "response": {
    "type": "",
    "fields": []
  }
}

接口片段：
{{CHUNK_TEXT}}
```

### B. 表格辅助提示词（可选）

```
你是表格解析助手。请把表格内容转成字段数组JSON。
表格内容包含参数名/类型/是否必填/说明/示例。
输出格式：
[
  {"name": "", "type": "", "required": false, "desc": "", "example": ""}
]
表格内容：
{{TABLE_TEXT}}
```

### C. 纠错修复提示词（后处理）

```
你是JSON修复助手。请根据规则修正接口JSON：
- method 只能是 GET/POST/PUT/DELETE/PATCH/UNKNOWN
- type 只能是 string/int/float/bool/object/array/unknown
- required 必须为 true/false
- path 必须以 / 开头
如果不确定就设为 UNKNOWN 或 unknown。
请输出修复后的JSON。
输入JSON：
{{RAW_JSON}}
```

## 四、质量控制建议

- 校验规则
  - path 必须以 `/` 开头
  - method 必须合法
  - response.type 必须存在
  - 如果 body 为空且 method 为 GET → body 允许空
- LLM 可信度
  - 每个接口块让模型输出 `confidence`（可选）
  - 信心低的接口进入人工校对

## 五、失败回退策略

- 表格太乱：先把表格转成“纯文本列块”，再让模型抽
- 字段缺失：让模型输出 `unknown`，后续人工补
- 文档无结构：先用 LLM 做“分段归类”再解析

## 六、MVP 快速实施建议

1. Word/PDF → 结构化文本
2. 用“主抽取提示词”直接跑
3. 结果 JSON → “修复提示词”
4. 统一输出 `api_list.json`
